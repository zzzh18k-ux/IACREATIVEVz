<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Casino 777 Free</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #020617; color: white; -webkit-tap-highlight-color: transparent; user-select: none; }
        .font-bebas { font-family: 'Bebas Neue', cursive; }
        .hidden { display: none !important; }
        /* Animaci√≥n Moneda */
        @keyframes bounce-custom { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .animate-bounce-custom { animation: bounce-custom 0.5s ease-in-out infinite; }
    </style>
</head>
<body class="bg-slate-950 pb-32">

    <div class="p-6 bg-slate-900/80 backdrop-blur-lg sticky top-0 z-50 border-b border-white/5 flex flex-col gap-4 shadow-2xl">
        <div class="flex justify-between items-center">
            <div>
                <p class="text-[10px] text-slate-500 font-black uppercase">Balance USDT</p>
                <p class="text-3xl font-black text-yellow-500 font-bebas" id="display-balance">$0.1000</p>
            </div>
            <button onclick="intentarRetiro()" class="px-4 py-2 rounded-xl font-black text-xs uppercase bg-slate-800 text-slate-500 transition-all" id="btn-withdraw">Retirar</button>
        </div>
        <div class="bg-slate-800/50 rounded-full h-6 relative overflow-hidden border border-white/5 p-1">
            <div id="progress-bar" class="h-full rounded-full bg-gradient-to-r from-orange-500 to-yellow-500 transition-all duration-500" style="width: 50%"></div>
            <div class="absolute inset-0 flex items-center justify-center text-[9px] font-black uppercase tracking-widest text-white drop-shadow-md">
                Meta: $<span id="prog-val">0.10</span> / $0.20
            </div>
        </div>
    </div>
    <div class="px-6 py-4 max-w-md mx-auto">
        <div id="game-msg" class="hidden p-4 rounded-2xl text-center font-black mb-4 border-2 animate-pulse bg-emerald-500/10 border-emerald-500 text-emerald-400">
            ¬°Ganaste!
        </div>

        <div id="view-menu" class="space-y-4">
            <button onclick="claimDailyBonus()" id="btn-daily" class="w-full p-6 rounded-3xl flex items-center justify-between border-2 shadow-2xl bg-slate-900 border-white/5 transition-all">
                <div class="text-left">
                    <p class="font-black uppercase text-sm text-slate-500" id="daily-label">Bono Diario</p>
                    <p class="font-bebas text-3xl text-white" id="daily-text">Cargando...</p>
                </div>
                <div class="text-5xl" id="daily-icon">üéÅ</div>
            </button>

            <button onclick="openTeam()" class="w-full p-4 rounded-2xl bg-yellow-500/10 border border-yellow-500/20 text-yellow-500 font-black uppercase tracking-widest active:scale-95 transition-all flex items-center justify-between">
                <span>üë• MI EQUIPO / GANANCIAS</span>
                <i class="fas fa-chevron-right"></i>
            </button>

            <h2 class="font-bebas text-2xl text-slate-400 tracking-widest pt-4">SAL√ìN DE JUEGOS</h2>
            
            <button onclick="openGame('mines')" class="w-full h-32 bg-gradient-to-br from-red-500 to-orange-600 rounded-3xl flex items-center justify-between px-8 shadow-xl active:scale-95 transition-transform">
                <div class="text-left"><p class="font-bebas text-5xl">MINAS</p><p class="text-[10px] font-bold opacity-70 uppercase">Multiplicador</p></div>
                <span class="text-6xl">üí£</span>
            </button>
            
            <button onclick="openGame('coin')" class="w-full h-32 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-3xl flex items-center justify-between px-8 shadow-xl active:scale-95 transition-transform">
                <div class="text-left"><p class="font-bebas text-5xl">MONEDA</p><p class="text-[10px] font-bold opacity-70 uppercase">Doble o Nada</p></div>
                <span class="text-6xl">ü™ô</span>
            </button>

            <div class="bg-slate-900/50 p-6 rounded-[2.5rem] border border-white/5 mt-8">
                <p class="text-[10px] text-slate-500 font-black uppercase text-center mb-1 tracking-widest">VIDEOS RECOMPENSADOS (+$0.0004)</p>
                <div class="grid grid-cols-2 gap-2 mt-4" id="video-grid"></div>
            </div>
        </div>

        <div id="view-team" class="hidden space-y-6">
            <div class="flex justify-between items-center">
                <button onclick="showMenu()" class="w-10 h-10 bg-white/5 rounded-full flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                <p class="font-bebas text-3xl text-yellow-500 tracking-widest">EQUIPO</p>
                <div class="w-10"></div>
            </div>
            <div class="bg-gradient-to-br from-slate-900 to-slate-950 p-8 rounded-3xl border border-yellow-500/20 text-center shadow-xl">
                <p class="text-[10px] font-black text-yellow-500 uppercase tracking-widest mb-2">Comisi√≥n Acumulada</p>
                <p class="text-5xl font-bebas text-white mb-6" id="team-balance">$0.0000</p>
                <button onclick="claimTeamEarnings()" id="btn-claim-team" class="w-full py-4 rounded-2xl font-black text-sm uppercase bg-slate-800 text-slate-500 transition-all">RECLAMAR AL BALANCE</button>
            </div>
            <div class="bg-slate-900/50 p-5 rounded-3xl border border-white/5 space-y-4">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest text-center">Tu Enlace de Invitaci√≥n</p>
                <div class="bg-slate-950 p-3 rounded-xl border border-white/5 overflow-hidden">
                    <p class="text-[10px] text-blue-400 break-all font-mono opacity-60 leading-tight" id="invite-link">Cargando...</p>
                </div>
                <button onclick="copyInvite()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-black text-[10px] uppercase shadow-lg active:scale-95 transition-all">COPIAR ENLACE</button>
            </div>
        </div>

        <div id="view-mines" class="hidden space-y-6">
            <div class="flex justify-between items-center">
                <button onclick="showMenu()" class="w-10 h-10 bg-white/5 rounded-full flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                <p class="font-bebas text-3xl text-yellow-500 tracking-widest">MINAS</p>
                <div class="w-10"></div>
            </div>
            <div class="grid grid-cols-5 gap-2 w-full max-w-[320px] mx-auto" id="mines-grid"></div>
            <div id="mines-controls" class="space-y-4">
                <div class="bg-slate-900 p-4 rounded-2xl border border-white/5">
                    <span class="text-[10px] font-black text-slate-500 uppercase">Bombas: <span id="bomb-count-display">3</span></span>
                    <input type="range" min="1" max="24" value="3" class="w-full h-2 bg-slate-800 rounded-lg appearance-none accent-yellow-500" oninput="updateMinesCount(this.value)">
                </div>
                <button onclick="startGameMines()" class="w-full py-5 bg-yellow-500 text-slate-950 rounded-3xl font-black text-xl shadow-xl active:scale-95">JUGAR</button>
            </div>
            <button id="mines-cashout" onclick="cashOutMines()" class="hidden w-full py-5 bg-emerald-500 rounded-3xl font-black text-xl shadow-lg active:scale-95">RETIRAR</button>
        </div>

        <div id="view-coin" class="hidden space-y-6 text-center">
             <div class="flex justify-between items-center mb-10">
                <button onclick="showMenu()" class="w-10 h-10 bg-white/5 rounded-full flex items-center justify-center"><i class="fas fa-arrow-left"></i></button>
                <p class="font-bebas text-3xl text-yellow-500 tracking-widest">MONEDA</p>
                <div class="w-10"></div>
            </div>
            <div id="coin-display" class="text-9xl transition-all duration-500">ü™ô</div>
            <div class="flex gap-4 w-full pt-10">
                <button onclick="playCoin('CARA')" class="flex-1 py-5 bg-blue-600 rounded-3xl font-black text-lg active:scale-95 shadow-lg">CARA</button>
                <button onclick="playCoin('SOL')" class="flex-1 py-5 bg-orange-600 rounded-3xl font-black text-lg active:scale-95 shadow-lg">SOL</button>
            </div>
        </div>

        <div id="bet-controls" class="hidden bg-slate-900 p-6 rounded-3xl border border-white/5 space-y-4 shadow-xl mt-6">
            <div class="flex justify-between items-end px-2">
                <span class="text-[10px] font-black text-slate-500 uppercase">Apuesta</span>
                <span class="text-2xl font-bebas text-white" id="bet-display">$0.0010</span>
            </div>
            <div class="grid grid-cols-3 gap-2">
                <button onclick="setBet('min')" class="py-3 bg-slate-800 rounded-xl font-bold text-[10px] uppercase">MIN</button>
                <button onclick="setBet('x2')" class="py-3 bg-slate-800 rounded-xl font-bold text-[10px] uppercase text-yellow-500">X2</button>
                <button onclick="setBet('half')" class="py-3 bg-slate-800 rounded-xl font-bold text-[10px] uppercase">1/2</button>
            </div>
        </div>
                    </div>
                    <script>
    // --- VARIABLES PRINCIPALES ---
    let user = { 
        balance: 0.10, 
        teamEarnings: 0, // Ganancias por equipo
        lastDaily: 0, 
        videoClaims: {},
        id: 'user_' + Math.random().toString(36).substr(2, 9) 
    };
    
    const C = { 
        MIN_BET: 0.001, 
        WITHDRAW: 0.20, 
        DAILY_REWARD: 0.005,
        VIDEO_REWARD: 0.0004,
        COOLDOWN: 24 * 60 * 60 * 1000,
        TEAM_PCT: 0.10 // 10% de comisi√≥n
    };
    
    let currentBet = 0.001;
    let minesCount = 3;
    let isPlaying = false;
    let minesGrid = []; 
    let multiplier = 1.0;
    let isAdPlaying = false;

    // INICIAR TODO
    const tg = window.Telegram.WebApp;
    tg.expand();
    loadData();
    renderUI();
    renderVideoButtons();
    setInterval(updateTimers, 1000);
    updateTimers();

    // --- FUNCIONES DE EQUIPO ---
    function openTeam() {
        document.getElementById('view-menu').classList.add('hidden');
        document.getElementById('view-team').classList.remove('hidden');
        updateTeamUI();
    }

    function updateTeamUI() {
        document.getElementById('team-balance').innerText = '$' + user.teamEarnings.toFixed(4);
        document.getElementById('invite-link').innerText = `https://t.me/Casino777free/play?startapp=${user.id}`;
        
        const btn = document.getElementById('btn-claim-team');
        if(user.teamEarnings > 0) {
            btn.classList.remove('bg-slate-800', 'text-slate-500');
            btn.classList.add('bg-yellow-500', 'text-slate-950', 'shadow-lg');
            btn.disabled = false;
        } else {
            btn.classList.add('bg-slate-800', 'text-slate-500');
            btn.classList.remove('bg-yellow-500', 'text-slate-950', 'shadow-lg');
            btn.disabled = true;
        }
    }

    function claimTeamEarnings() {
        if(user.teamEarnings <= 0) return;
        user.balance += user.teamEarnings;
        user.teamEarnings = 0;
        saveData(); renderUI(); updateTeamUI();
        alert("¬°Comisi√≥n a√±adida al balance!");
    }

    function copyInvite() {
        const link = document.getElementById('invite-link').innerText;
        navigator.clipboard.writeText(link);
        alert("¬°Enlace copiado!");
    }

    // Calcula y a√±ade comisi√≥n al ganar
    function addCommission(profit) {
        if(profit <= 0) return;
        user.teamEarnings += (profit * C.TEAM_PCT);
    }

    // --- ANUNCIOS (Monetag) ---
    async function showAd() {
        if(isAdPlaying) return Promise.reject("Cargando...");
        isAdPlaying = true;
        return new Promise((resolve) => {
            if (window.show_10278425) {
                window.show_10278425().then(() => { isAdPlaying=false; resolve(true); })
                .catch(() => { isAdPlaying=false; resolve(true); });
            } else {
                isAdPlaying = false; resolve(true); // Modo prueba
            }
        });
    }

    // --- BONOS Y VIDEOS ---
    async function claimDailyBonus() {
        const now = Date.now();
        if ((now - user.lastDaily) < C.COOLDOWN) return;
        try {
            await showAd();
            user.balance += C.DAILY_REWARD;
            user.lastDaily = Date.now();
            saveData(); renderUI(); updateTimers();
            alert("¬°Bono Recibido!");
        } catch(e) {}
    }

    async function watchVideo(id) {
        const now = Date.now();
        const last = user.videoClaims[id] || 0;
        if ((now - last) < C.COOLDOWN) return;
        try {
            await showAd();
            user.balance += C.VIDEO_REWARD;
            user.videoClaims[id] = Date.now();
            saveData(); renderUI(); updateTimers();
            alert(`¬°Video #${id} completado!`);
        } catch(e) {}
    }

    function updateTimers() {
        const now = Date.now();
        // Bono Diario
        const diffDaily = (user.lastDaily + C.COOLDOWN) - now;
        if (diffDaily > 0) {
            const h = Math.floor(diffDaily/3600000);
            const m = Math.floor((diffDaily%3600000)/60000);
            document.getElementById('daily-text').innerText = `${h}h ${m}m`;
            document.getElementById('daily-text').className = "font-bebas text-3xl text-slate-500";
            document.getElementById('btn-daily').classList.add('opacity-75', 'cursor-not-allowed');
            document.getElementById('btn-daily').classList.remove('animate-pulse');
        } else {
            document.getElementById('daily-text').innerText = `$${C.DAILY_REWARD} USDT`;
            document.getElementById('daily-text').className = "font-bebas text-3xl text-white";
            document.getElementById('btn-daily').classList.remove('opacity-75', 'cursor-not-allowed');
            document.getElementById('btn-daily').classList.add('animate-pulse');
        }
        // Videos
        for(let i=1; i<=7; i++) {
            const btn = document.getElementById(`vid-btn-${i}`);
            if(!btn) continue;
            const last = user.videoClaims[i] || 0;
            const diff = (last + C.COOLDOWN) - now;
            if(diff > 0) {
                const h = Math.floor(diff/3600000);
                const m = Math.floor((diff%3600000)/60000);
                btn.innerText = `‚è≥ ${h}h ${m}m`;
                btn.className = "py-3 rounded-xl font-bold text-[10px] border bg-slate-950 text-slate-600 cursor-not-allowed";
                btn.disabled = true;
            } else {
                btn.innerText = `VIDEO #${i} ‚ñ∑`;
                btn.className = "py-3 rounded-xl font-bold text-[10px] border bg-blue-500/10 border-blue-500/20 text-blue-400 active:scale-95";
                btn.disabled = false;
            }
        }
    }

    function renderVideoButtons() {
        const grid = document.getElementById('video-grid');
        grid.innerHTML = '';
        for(let i=1; i<=7; i++) {
            const btn = document.createElement('button');
            btn.id = `vid-btn-${i}`;
            btn.onclick = () => watchVideo(i);
            grid.appendChild(btn);
        }
    }

    // --- JUEGOS ---
    function showMenu() {
        ['view-mines','view-coin','view-team','bet-controls','game-msg'].forEach(id => document.getElementById(id).classList.add('hidden'));
        document.getElementById('view-menu').classList.remove('hidden');
    }
    
    function openGame(g) {
        document.getElementById('view-menu').classList.add('hidden');
        document.getElementById('bet-controls').classList.remove('hidden');
        if(g === 'mines') { document.getElementById('view-mines').classList.remove('hidden'); initMinesGrid(); }
        else { document.getElementById('view-coin').classList.remove('hidden'); }
    }

    function startGameMines() {
        if(user.balance < currentBet) return alert("Saldo insuficiente");
        user.balance -= currentBet;
        isPlaying = true; multiplier = 1.0; minesGrid.fill('gem');
        let p = 0;
        while(p < minesCount) { let r = Math.floor(Math.random()*25); if(minesGrid[r]!=='bomb'){ minesGrid[r]='bomb'; p++; } }
        document.getElementById('mines-controls').classList.add('hidden');
        document.getElementById('mines-cashout').classList.remove('hidden');
        saveData(); renderUI();
    }

    function clickTile(i) {
        if(!isPlaying) return;
        const t = document.getElementById(`tile-${i}`);
        if(t.classList.contains('bg-slate-800')) return;
        if(minesGrid[i] === 'bomb') {
            t.innerHTML = 'üí£'; t.className = t.className.replace('bg-slate-700','bg-red-500');
            gameOver(false, "¬°BOOM! Perdiste");
        } else {
            t.innerHTML = 'üíé'; t.className = t.className.replace('bg-slate-700','bg-slate-800');
            multiplier += 0.2; 
            document.getElementById('mines-cashout').innerText = `RETIRAR $${(currentBet*multiplier).toFixed(4)}`;
        }
    }

    function cashOutMines() {
        if(!isPlaying) return;
        const win = currentBet * multiplier;
        const profit = win - currentBet;
        user.balance += win;
        addCommission(profit); // + Comisi√≥n
        gameOver(true, `Ganaste $${win.toFixed(4)}`);
    }

    function playCoin(choice) {
        if(user.balance < currentBet) return alert("Saldo insuficiente");
        user.balance -= currentBet; renderUI();
        const d = document.getElementById('coin-display');
        d.classList.add('animate-bounce-custom'); d.innerText = '‚ùì';
        setTimeout(() => {
            const res = Math.random()>0.5 ? 'CARA' : 'SOL';
            d.classList.remove('animate-bounce-custom'); d.innerText = res==='CARA'?'ü™ô':'‚òÄÔ∏è';
            if(choice===res) {
                const win = currentBet * 1.95;
                const profit = win - currentBet;
                user.balance += win;
                addCommission(profit); // + Comisi√≥n
                gameOver(true, `¬°${res}! Ganaste $${win.toFixed(4)}`);
            } else gameOver(false, `¬°${res}! Perdiste`);
        }, 1000);
    }

    function initMinesGrid() {
        const grid = document.getElementById('mines-grid');
        grid.innerHTML = ''; minesGrid = Array(25).fill('empty');
        document.getElementById('mines-controls').classList.remove('hidden');
        document.getElementById('mines-cashout').classList.add('hidden');
        for(let i=0; i<25; i++) {
            const t = document.createElement('div');
            t.className = "aspect-square bg-slate-700 rounded-xl flex items-center justify-center text-2xl border border-white/5 active:scale-95 transition-all";
            t.id = `tile-${i}`; t.onclick = () => clickTile(i);
            grid.appendChild(t);
        }
    }
    
    function updateMinesCount(v) { minesCount = parseInt(v); document.getElementById('bomb-count-display').innerText = minesCount; }
    
    function setBet(t) {
        if(t==='min') currentBet = C.MIN_BET;
        if(t==='x2') currentBet = Math.min(user.balance, currentBet*2);
        if(t==='half') currentBet = Math.max(C.MIN_BET, currentBet/2);
        renderUI();
    }

    function gameOver(win, msg) {
        isPlaying = false; saveData(); renderUI();
        const el = document.getElementById('game-msg');
        el.innerText = msg; el.classList.remove('hidden');
        el.className = win ? "p-4 rounded-2xl text-center font-black mb-4 border-2 bg-emerald-500/10 border-emerald-500 text-emerald-400" : "p-4 rounded-2xl text-center font-black mb-4 border-2 bg-red-500/10 border-red-500 text-red-400";
        if(window.Telegram.WebApp.HapticFeedback) window.Telegram.WebApp.HapticFeedback.notificationOccurred(win?'success':'error');
        if(!win && minesGrid.length>0) minesGrid.forEach((v,i)=>{ if(v==='bomb') document.getElementById(`tile-${i}`).innerHTML='üí£'; });
        setTimeout(() => { if(!document.getElementById('view-mines').classList.contains('hidden')) document.getElementById('mines-controls').classList.remove('hidden'); }, 1500);
    }

    function renderUI() {
        document.getElementById('display-balance').innerText = '$' + user.balance.toFixed(4);
        document.getElementById('prog-val').innerText = user.balance.toFixed(2);
        document.getElementById('bet-display').innerText = '$' + currentBet.toFixed(4);
        let pct = (user.balance / C.WITHDRAW) * 100;
        document.getElementById('progress-bar').style.width = pct + '%';
        const btnW = document.getElementById('btn-withdraw');
        if(user.balance >= C.WITHDRAW) {
            btnW.className = "px-4 py-2 rounded-xl font-black text-xs uppercase bg-emerald-500 text-white animate-pulse transition-all";
        }
    }

    function intentarRetiro() {
        if(user.balance >= C.WITHDRAW) alert("¬°Felicidades! Captura esta pantalla y env√≠ala al soporte.");
        else alert(`Necesitas llegar a $${C.WITHDRAW} USDT`);
    }

    function loadData() {
        const s = localStorage.getItem('casino777_final_v3');
        if(s) { 
            const d = JSON.parse(s); 
            user.balance = d.balance || 0.10; 
            user.teamEarnings = d.teamEarnings || 0; 
            user.lastDaily = d.lastDaily || 0; 
            user.videoClaims = d.videoClaims || {};
            user.id = d.id || user.id;
        }
    }
    function saveData() { localStorage.setItem('casino777_final_v3', JSON.stringify(user)); }
</script>
</body>
</html>

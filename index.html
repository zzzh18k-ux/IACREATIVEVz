<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Casino 777 Free</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; user-select: none; }
        .font-bebas { font-family: 'Bebas Neue', cursive; }
        .hidden { display: none !important; }
        
        /* Efectos Visuales */
        .icon-glow { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
        .gold-glow { filter: drop-shadow(0 0 8px rgba(234, 179, 8, 0.6)); }
        .danger-glow { filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.6)); }
        
        /* Animaciones */
        @keyframes flip-coin { 0% { transform: rotateY(0); } 100% { transform: rotateY(720deg); } }
        .animate-flip { animation: flip-coin 0.6s ease-out; }
        
        @keyframes bounce-custom { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-bounce-custom { animation: bounce-custom 0.5s ease-in-out infinite; }
    </style>
</head>
<body class="bg-slate-950 pb-20">

    <div class="px-5 py-4 bg-slate-900/90 backdrop-blur-md sticky top-0 z-50 border-b border-white/5 flex flex-col gap-3 shadow-lg">
        <div class="flex justify-between items-center">
            <div class="flex flex-col">
                <span class="text-[9px] text-slate-400 font-bold uppercase tracking-wider">Tu Balance</span>
                <div class="flex items-center gap-2">
                    <i class="fas fa-wallet text-emerald-400 text-sm"></i>
                    <span class="text-2xl font-black text-white font-bebas tracking-wide" id="display-balance">$0.1000</span>
                </div>
            </div>
            <button onclick="intentarRetiro()" class="px-4 py-2 rounded-lg font-bold text-[10px] uppercase bg-slate-800 text-slate-400 border border-white/5 active:bg-slate-700 transition-all" id="btn-withdraw">
                <i class="fas fa-money-bill-transfer mr-1"></i> Retirar
            </button>
        </div>
        <div class="w-full bg-slate-800 rounded-full h-1.5 overflow-hidden">
            <div id="progress-bar" class="h-full bg-gradient-to-r from-emerald-500 to-teal-400 transition-all duration-500" style="width: 50%"></div>
        </div>
        <div class="text-center text-[8px] text-slate-500 uppercase font-bold">
            Meta: $<span id="prog-val">0.10</span> / $0.20
        </div>
    </div>

    <div class="px-4 py-4 max-w-md mx-auto space-y-4">
        
        <div id="game-msg" class="hidden p-3 rounded-xl text-center font-bold text-sm mb-2 border animate-pulse flex items-center justify-center gap-2"></div>

        <div id="view-menu" class="space-y-3">
            
            <button onclick="claimDailyBonus()" id="btn-daily" class="w-full p-4 rounded-2xl flex items-center justify-between border border-white/5 bg-gradient-to-r from-slate-900 to-slate-800 shadow-md active:scale-[0.98] transition-all">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-yellow-500/10 flex items-center justify-center text-yellow-500 border border-yellow-500/20">
                        <i class="fas fa-gift text-lg" id="daily-icon"></i>
                    </div>
                    <div class="text-left">
                        <p class="font-bold text-[10px] text-slate-400 uppercase" id="daily-label">Bono Diario</p>
                        <p class="font-bebas text-xl text-white" id="daily-text">Cargando...</p>
                    </div>
                </div>
                <i class="fas fa-chevron-right text-xs text-slate-600"></i>
            </button>

            <button onclick="openTeam()" class="w-full py-3 px-4 rounded-xl bg-slate-800/50 border border-white/5 text-slate-300 font-bold text-[10px] uppercase flex items-center justify-between active:bg-slate-800">
                <span class="flex items-center gap-2"><i class="fas fa-users text-blue-400"></i> Equipo & Ganancias</span>
                <i class="fas fa-arrow-right text-slate-600"></i>
            </button>

            <h2 class="font-bebas text-lg text-slate-500 tracking-widest pl-1 mt-4">JUEGOS</h2>
            
            <div class="grid grid-cols-2 gap-3">
                <button onclick="openGame('mines')" class="h-28 bg-gradient-to-br from-red-600/90 to-red-800/90 rounded-2xl p-4 flex flex-col justify-between border border-white/10 shadow-lg relative overflow-hidden active:scale-[0.98] transition-all">
                    <i class="fas fa-bomb text-4xl text-white/20 absolute -bottom-2 -right-2"></i>
                    <i class="fas fa-bomb text-2xl text-white mb-2 icon-glow"></i>
                    <div class="text-left relative z-10">
                        <p class="font-bebas text-2xl leading-none">MINAS</p>
                        <p class="text-[8px] font-bold opacity-80 uppercase">Multiplicador</p>
                    </div>
                </button>
                
                <button onclick="openGame('coin')" class="h-28 bg-gradient-to-br from-blue-600/90 to-blue-800/90 rounded-2xl p-4 flex flex-col justify-between border border-white/10 shadow-lg relative overflow-hidden active:scale-[0.98] transition-all">
                    <i class="fas fa-coins text-4xl text-white/20 absolute -bottom-2 -right-2"></i>
                    <i class="fas fa-circle-dollar-to-slot text-2xl text-white mb-2 icon-glow"></i>
                    <div class="text-left relative z-10">
                        <p class="font-bebas text-2xl leading-none">MONEDA</p>
                        <p class="text-[8px] font-bold opacity-80 uppercase">50/50</p>
                    </div>
                </button>
            </div>

            <div class="bg-slate-900/50 p-4 rounded-2xl border border-white/5 mt-4">
                <div class="flex items-center gap-2 mb-3 justify-center text-slate-500">
                    <i class="fas fa-play-circle text-xs"></i>
                    <p class="text-[9px] font-black uppercase tracking-widest">VIDEOS (+0.0004)</p>
                </div>
                <div class="grid grid-cols-4 gap-2" id="video-grid"></div>
            </div>
        </div>

        <div id="view-team" class="hidden space-y-4">
            <div class="flex items-center gap-3">
                <button onclick="showMenu()" class="w-8 h-8 bg-slate-800 rounded-full flex items-center justify-center text-slate-400 active:bg-slate-700"><i class="fas fa-arrow-left text-xs"></i></button>
                <p class="font-bebas text-2xl text-white">TU EQUIPO</p>
            </div>
            
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl border border-white/5 text-center relative overflow-hidden">
                <div class="relative z-10">
                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-1">Comisiones</p>
                    <p class="text-4xl font-bebas text-yellow-400 gold-glow mb-4" id="team-balance">$0.0000</p>
                    <button onclick="claimTeamEarnings()" id="btn-claim-team" class="w-full py-3 rounded-xl font-black text-[10px] uppercase bg-slate-700 text-slate-500 transition-all">RECLAMAR</button>
                </div>
            </div>

            <div class="bg-slate-900 p-4 rounded-2xl border border-white/5 space-y-3">
                <p class="text-[9px] font-bold text-slate-500 uppercase text-center">Tu Enlace</p>
                <div class="bg-black/30 p-2 rounded-lg border border-white/5">
                    <p class="text-[9px] text-blue-400 font-mono truncate" id="invite-link">...</p>
                </div>
                <button onclick="copyInvite()" class="w-full bg-blue-600/20 text-blue-400 border border-blue-500/30 py-2 rounded-lg font-bold text-[9px] uppercase active:bg-blue-600/30">COPIAR</button>
            </div>
        </div>

        <div id="view-mines" class="hidden space-y-4">
            <div class="flex items-center justify-between">
                <button onclick="showMenu()" class="w-8 h-8 bg-slate-800 rounded-full flex items-center justify-center text-slate-400"><i class="fas fa-arrow-left text-xs"></i></button>
                <p class="font-bebas text-2xl text-red-500">MINAS</p>
                <div class="w-8"></div>
            </div>
            
            <div class="grid grid-cols-5 gap-2 w-full max-w-[280px] mx-auto p-2 bg-slate-900/50 rounded-2xl border border-white/5" id="mines-grid"></div>
            
            <div id="mines-controls" class="space-y-3">
                <div class="bg-slate-900 px-4 py-3 rounded-xl border border-white/5 flex items-center justify-between">
                    <span class="text-[10px] font-bold text-slate-400 uppercase"><i class="fas fa-bomb mr-1"></i> Bombas</span>
                    <div class="flex items-center gap-3">
                        <span class="font-bebas text-xl text-white w-4 text-center" id="bomb-count-display">3</span>
                        <input type="range" min="1" max="24" value="3" class="w-24 h-1 bg-slate-700 rounded-lg appearance-none accent-red-500" oninput="updateMinesCount(this.value)">
                    </div>
                </div>
                <button onclick="startGameMines()" class="w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-slate-900 rounded-xl font-black text-sm uppercase shadow-[0_0_15px_rgba(234,179,8,0.3)] active:scale-[0.98] transition-all">JUGAR AHORA</button>
            </div>
            <button id="mines-cashout" onclick="cashOutMines()" class="hidden w-full py-4 bg-emerald-500 text-white rounded-xl font-black text-sm uppercase shadow-[0_0_15px_rgba(16,185,129,0.3)] active:scale-[0.98]">RETIRAR</button>
        </div>

        <div id="view-coin" class="hidden space-y-6 text-center pt-8">
             <div class="flex items-center justify-between absolute top-4 left-4 right-4">
                <button onclick="showMenu()" class="w-8 h-8 bg-slate-800 rounded-full flex items-center justify-center text-slate-400"><i class="fas fa-arrow-left text-xs"></i></button>
                <p class="font-bebas text-2xl text-blue-500">MONEDA</p>
                <div class="w-8"></div>
            </div>
            
            <div id="coin-display" class="w-32 h-32 mx-auto bg-slate-800 rounded-full flex items-center justify-center border-4 border-slate-700 shadow-2xl relative">
                <i class="fas fa-question text-5xl text-slate-500"></i>
            </div>
            
            <div class="grid grid-cols-2 gap-4 w-full pt-4">
                <button onclick="playCoin('CARA')" class="py-4 bg-blue-600/20 border border-blue-500/50 text-blue-400 rounded-2xl font-black text-sm hover:bg-blue-600 hover:text-white transition-all active:scale-[0.98]"><i class="fas fa-circle mb-1 block text-lg"></i> CARA</button>
                <button onclick="playCoin('SOL')" class="py-4 bg-orange-600/20 border border-orange-500/50 text-orange-400 rounded-2xl font-black text-sm hover:bg-orange-600 hover:text-white transition-all active:scale-[0.98]"><i class="fas fa-sun mb-1 block text-lg"></i> SOL</button>
            </div>
        </div>

        <div id="bet-controls" class="hidden bg-slate-900 p-4 rounded-2xl border border-white/5 space-y-3 shadow-xl">
            <div class="flex justify-between items-end px-1">
                <span class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Apuesta</span>
                <span class="text-xl font-bebas text-white" id="bet-display">$0.0010</span>
            </div>
            <div class="grid grid-cols-3 gap-2">
                <button onclick="setBet('min')" class="py-2 bg-slate-800 rounded-lg font-bold text-[9px] text-slate-400 uppercase hover:bg-slate-700">MIN</button>
                <button onclick="setBet('x2')" class="py-2 bg-slate-800 rounded-lg font-bold text-[9px] text-yellow-500 uppercase hover:bg-slate-700">X2</button>
                <button onclick="setBet('half')" class="py-2 bg-slate-800 rounded-lg font-bold text-[9px] text-slate-400 uppercase hover:bg-slate-700">1/2</button>
            </div>
        </div>
    </div>

<script>
    const BOT_USERNAME = "FreCasino777_bot"; 

    // --- VARIABLES ---
    let savedData = localStorage.getItem('casino777_pro_final_v3');
    let parsedData = savedData ? JSON.parse(savedData) : {};

    let user = { 
        balance: parsedData.balance !== undefined ? parsedData.balance : 0.10, 
        teamEarnings: parsedData.teamEarnings || 0,
        lastDaily: parsedData.lastDaily || 0, 
        videoClaims: parsedData.videoClaims || {},
        id: parsedData.id || 'u_' + Math.random().toString(36).substr(2, 8)
    };

    const C = { MIN_BET: 0.001, WITHDRAW: 0.20, DAILY_REWARD: 0.005, VIDEO_REWARD: 0.0004, COOLDOWN: 24*60*60*1000, TEAM_PCT: 0.10 };
    let currentBet = 0.001, minesCount = 3, isPlaying = false, minesGrid = [], multiplier = 1.0, isAdPlaying = false;

    // --- INICIO ---
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.setHeaderColor('#0f172a');
    
    saveData(); renderUI(); renderVideoButtons();
    setInterval(updateTimers, 1000); updateTimers();

    // --- FUNCIONES UI ---
    function openTeam() { showScreen('view-team'); updateTeamUI(); }
    
    function showScreen(id) {
        ['view-menu','view-team','view-mines','view-coin','bet-controls','game-msg'].forEach(el => document.getElementById(el).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }
    function showMenu() { showScreen('view-menu'); document.getElementById('bet-controls').classList.add('hidden'); }

    function updateTeamUI() {
        document.getElementById('team-balance').innerText = '$' + user.teamEarnings.toFixed(4);
        document.getElementById('invite-link').innerText = `t.me/${BOT_USERNAME}/play?startapp=${user.id}`;
        const btn = document.getElementById('btn-claim-team');
        if(user.teamEarnings > 0) {
            btn.className = "w-full py-3 rounded-xl font-black text-[10px] uppercase bg-yellow-500 text-slate-900 shadow-lg active:scale-95 transition-all";
            btn.disabled = false;
        } else {
            btn.className = "w-full py-3 rounded-xl font-black text-[10px] uppercase bg-slate-700 text-slate-500 cursor-not-allowed";
            btn.disabled = true;
        }
    }

    function claimTeamEarnings() {
        if(user.teamEarnings <= 0) return;
        user.balance += user.teamEarnings; user.teamEarnings = 0;
        saveData(); renderUI(); updateTeamUI(); showMsg(true, "¡Comisión reclamada!");
    }

    function copyInvite() {
        const link = document.getElementById('invite-link').innerText;
        const el = document.createElement('textarea'); el.value = link; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
        showMsg(true, "Enlace Copiado");
    }

    // --- JUEGOS ---
    function openGame(g) {
        showScreen(g === 'mines' ? 'view-mines' : 'view-coin');
        document.getElementById('bet-controls').classList.remove('hidden');
        if(g === 'mines') initMinesGrid();
    }

    function initMinesGrid() {
        const grid = document.getElementById('mines-grid');
        grid.innerHTML = ''; minesGrid = Array(25).fill('empty');
        document.getElementById('mines-controls').classList.remove('hidden');
        document.getElementById('mines-cashout').classList.add('hidden');
        
        for(let i=0; i<25; i++) {
            const t = document.createElement('div');
            t.className = "aspect-square bg-slate-800 rounded-lg flex items-center justify-center text-xl shadow-inner cursor-pointer active:scale-95 transition-transform duration-100 border border-white/5 hover:bg-slate-700 select-none";
            t.id = `tile-${i}`; t.onclick = () => clickTile(i);
            grid.appendChild(t);
        }
    }

    function clickTile(i) {
        if(!isPlaying) { showMsg(false, "¡Dale a JUGAR primero!"); return; }
        const t = document.getElementById(`tile-${i}`);
        if(t.classList.contains('revealed')) return;

        t.classList.add('revealed');
        t.classList.remove('cursor-pointer', 'active:scale-95', 'hover:bg-slate-700', 'bg-slate-800');
        
        if(minesGrid[i] === 'bomb') {
            t.innerHTML = '<i class="fas fa-bomb text-red-500 text-xl danger-glow"></i>';
            t.className = "aspect-square bg-red-500/20 rounded-lg flex items-center justify-center border border-red-500/50 transition-all duration-300 transform scale-100";
            gameOver(false, "¡BOOM!");
        } else {
            t.innerHTML = '<i class="fas fa-gem text-emerald-400 text-lg icon-glow animate-bounce-custom"></i>';
            t.className = "aspect-square bg-emerald-500/20 rounded-lg flex items-center justify-center border border-emerald-500/50 transition-all duration-300 transform scale-100";
            multiplier += 0.2; 
            document.getElementById('mines-cashout').innerText = `RETIRAR $${(currentBet*multiplier).toFixed(4)}`;
        }
    }

    function startGameMines() {
        if(user.balance < currentBet) return showMsg(false, "Saldo Insuficiente");
        user.balance -= currentBet; isPlaying = true; multiplier = 1.0; minesGrid.fill('gem');
        let p = 0; while(p < minesCount) { let r = Math.floor(Math.random()*25); if(minesGrid[r]!=='bomb'){ minesGrid[r]='bomb'; p++; } }
        document.getElementById('mines-controls').classList.add('hidden');
        document.getElementById('mines-cashout').classList.remove('hidden');
        saveData(); renderUI();
    }

    function cashOutMines() {
        if(!isPlaying) return;
        const w = currentBet * multiplier;
        user.balance += w; addCommission(w - currentBet); gameOver(true, `+$${w.toFixed(4)}`);
    }

    function playCoin(choice) {
        if(user.balance < currentBet) return showMsg(false, "Saldo Insuficiente");
        user.balance -= currentBet; renderUI();
        const d = document.getElementById('coin-display');
        d.innerHTML = '<i class="fas fa-question text-5xl text-slate-500"></i>';
        d.classList.add('animate-flip'); 

        setTimeout(() => {
            const res = Math.random()>0.5 ? 'CARA' : 'SOL';
            d.classList.remove('animate-flip');
            if(res === 'CARA') d.innerHTML = '<i class="fas fa-circle text-5xl text-blue-400 icon-glow"></i>';
            else d.innerHTML = '<i class="fas fa-sun text-5xl text-orange-400 gold-glow"></i>';

            if(choice === res) {
                const w = currentBet * 1.95; user.balance += w; addCommission(w - currentBet); gameOver(true, `+$${w.toFixed(4)}`);
            } else gameOver(false, "Perdiste");
        }, 600);
    }

    function gameOver(win, txt) {
        isPlaying = false; saveData(); renderUI(); showMsg(win, txt);
        if(!win && minesGrid.length>0) {
            minesGrid.forEach((v, i) => { 
                if(v === 'bomb') {
                    const tile = document.getElementById(`tile-${i}`);
                    if(!tile.classList.contains('revealed')) {
                        tile.innerHTML = '<i class="fas fa-bomb text-red-500 opacity-50"></i>';
                        tile.classList.remove('active:scale-95', 'cursor-pointer');
                    }
        

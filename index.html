<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Moon Miner App</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        /* --- ESTILOS GENERALES (Modo Oscuro) --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: white;
            font-family: 'Roboto', sans-serif;
            overflow: hidden; /* Para que parezca una app */
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- PANTALLA DE INICIO (HOME) --- */
        #homeScreen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: radial-gradient(circle at top, #1e1e2f 0%, #000 80%);
            position: relative;
            z-index: 2;
        }

        .header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #ccc;
        }

        /* T√≠tulo Grande estilo Moonbix */
        .logo-area {
            margin-top: 20px;
            text-align: center;
        }
        .logo-text {
            font-size: 38px;
            font-weight: 900;
            color: #1e1e1e; /* Color oscuro de fondo */
            -webkit-text-stroke: 1px #FCD535; /* Borde amarillo */
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        .mascot {
            font-size: 60px;
            margin: -10px 0 20px 0;
            display: block;
        }

        /* Bot√≥n Principal de Jugar */
        .play-btn-container {
            margin-bottom: 30px;
            text-align: center;
            width: 100%;
        }

        .btn-main {
            background-color: #FCD535; /* Amarillo Binance */
            color: #000;
            font-size: 20px;
            font-weight: bold;
            padding: 15px 60px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(252, 213, 53, 0.4);
            width: 80%;
            max-width: 300px;
            transition: transform 0.1s;
        }
        .btn-main:active { transform: scale(0.95); }
        
        .btn-disabled {
            background-color: #555;
            color: #aaa;
            box-shadow: none;
            cursor: not-allowed;
        }

        .energy-text {
            margin-top: 10px;
            color: #888;
            font-size: 14px;
        }

        /* Lista de Botones (Grupo, Historial) */
        .menu-list {
            width: 100%;
            max-width: 350px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .menu-item {
            background-color: #1E2329;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border: 1px solid #333;
        }
        .menu-item:active { background-color: #2b313a; }
        
        .menu-icon { margin-right: 10px; }
        .arrow { color: #666; }

        /* Barra de Navegaci√≥n Inferior (Decorativa) */
        .bottom-nav {
            height: 70px;
            background-color: #1E2329;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #333;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 10px;
            color: #666;
            gap: 5px;
        }
        .nav-item.active { color: #FCD535; }
        .nav-icon { font-size: 20px; }

        /* --- PANTALLA DEL JUEGO (Oculta al inicio) --- */
        #gameScreen {
            display: none; /* Oculto por defecto */
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            z-index: 10;
        }
        canvas { display: block; width: 100%; height: 100%; }

        /* Bot√≥n volver en el juego */
        .back-btn {
            position: absolute;
            top: 20px; left: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: 1px solid white;
            padding: 5px 15px;
            border-radius: 20px;
            z-index: 20;
            cursor: pointer;
        }

        /* Popups */
        .popup {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #2b313a; padding: 20px; border-radius: 15px;
            border: 1px solid #444; text-align: center; z-index: 100;
            display: none; width: 80%;
        }
        .popup h3 { color: #FCD535; margin-top: 0;}
    </style>
</head>
<body>

    <div id="homeScreen">
        <div class="header">
            <div class="user-info">
                <span>üë§ Usuario123</span>
            </div>
            <div style="font-weight: bold;">
                <span style="color:#FCD535">‚óè</span> 80.550 Puntos
            </div>
        </div>

        <div class="logo-area">
            <div class="logo-text">SPACE MINER</div>
            <div class="mascot">üë®‚ÄçüöÄ</div> </div>

        <div class="play-btn-container">
            <button id="btnJugar" class="btn-main" onclick="intentarJugar()">
                JUGAR AHORA
            </button>
            <div class="energy-text" id="energyText">Juegos disponibles: 10/10</div>
            <div class="energy-text" id="timerText" style="display:none; color: #ff4444;">
                Pr√≥xima recarga en: 30:00
            </div>
        </div>

        <div class="menu-list">
            <div class="menu-item" onclick="mostrarAlerta('Abriendo Telegram...')">
                <div>üì¢ Unirse al Grupo Oficial</div>
                <div class="arrow">></div>
            </div>
            <div class="menu-item" onclick="mostrarAlerta('Historial de Ganancias: Vac√≠o')">
                <div>üí∞ Historial de Ganancias</div>
                <div class="arrow">></div>
            </div>
            <div class="menu-item" onclick="mostrarAlerta('Historial de Retiros: Sin retiros')">
                <div>üè¶ Historial de Retiros</div>
                <div class="arrow">></div>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active">
            <span class="nav-icon">üè†</span> Inicio
        </div>
        <div class="nav-item">
            <span class="nav-icon">üìä</span> Ranking
        </div>
        <div class="nav-item">
            <span class="nav-icon">‚õèÔ∏è</span> Miner√≠a
        </div>
        <div class="nav-item">
            <span class="nav-icon">üéÅ</span> Sorpresa
        </div>
    </div>

    <div id="gameScreen">
        <button class="back-btn" onclick="salirDelJuego()">x Salir</button>
        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="infoPopup" class="popup">
        <h3 id="popupTitle">Informaci√≥n</h3>
        <p id="popupMsg">Mensaje</p>
        <button onclick="cerrarPopup()" style="padding: 10px 30px; background:#FCD535; border:none; border-radius:5px; font-weight:bold;">OK</button>
    </div>

<script>
    // --- L√ìGICA DE ENERG√çA Y TIEMPO (LO IMPORTANTE) ---
    
    // Configuraci√≥n
    const MAX_GAMES = 10;
    const COOLDOWN_MINUTES = 30;
    
    // Estado (Variables de memoria)
    let gamesLeft = 10;
    let cooldownEndTime = null; // Guardar√° la hora en que termina el bloqueo
    let timerInterval = null;

    // Elementos del DOM
    const btnJugar = document.getElementById('btnJugar');
    const energyText = document.getElementById('energyText');
    const timerText = document.getElementById('timerText');
    const homeScreen = document.getElementById('homeScreen');
    const gameScreen = document.getElementById('gameScreen');

    // Funci√≥n 1: Intentar entrar al juego
    function intentarJugar() {
        // Verificar si hay bloqueo de tiempo
        if (cooldownEndTime && new Date() < cooldownEndTime) {
            mostrarAlerta("¬°Descansa un poco! Espera a que termine el tiempo.");
            return;
        }

        // Verificar si quedan vidas
        if (gamesLeft > 0) {
            iniciarJuegoReal(); // Lanza el juego
        } else {
            // Si llega aqu√≠ es porque gamesLeft es 0 pero no hay fecha de bloqueo (raro, pero prevenimos)
            iniciarBloqueo();
        }
    }

    // Funci√≥n 2: Cuando termina un juego (Game Over)
    function juegoTerminado() {
        gamesLeft--; // Quitar una vida
        actualizarInterfazHome();
        salirDelJuego(); // Volver al men√∫

        if (gamesLeft <= 0) {
            iniciarBloqueo();
        }
    }

    // Funci√≥n 3: Activar el bloqueo de 30 minutos
    function iniciarBloqueo() {
        const ahora = new Date();
        // Sumar 30 minutos a la hora actual
        cooldownEndTime = new Date(ahora.getTime() + COOLDOWN_MINUTES * 60000);
        
        actualizarInterfazHome();
        
        // Arrancar el reloj visual
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(actualizarReloj, 1000);
    }

    // Funci√≥n 4: Actualizar textos y botones del men√∫
    function actualizarInterfazHome() {
        // Texto de vidas
        energyText.innerText = `Juegos disponibles: ${gamesLeft}/${MAX_GAMES}`;

        // Estado del bot√≥n y reloj
        if (cooldownEndTime && new Date() < cooldownEndTime) {
            // BLOQUEADO
            btnJugar.classList.add('btn-disabled');
            btnJugar.innerText = "RECARGANDO...";
            energyText.style.display = 'none';
            timerText.style.display = 'block';
        } else {
            // DESBLOQUEADO
            // Si ya pas√≥ el tiempo, reseteamos las vidas
            if (cooldownEndTime && new Date() >= cooldownEndTime) {
                gamesLeft = MAX_GAMES;
                cooldownEndTime = null;
                clearInterval(timerInterval);
            }
            
            btnJugar.classList.remove('btn-disabled');
            btnJugar.innerText = `JUGAR AHORA (${gamesLeft})`;
            energyText.style.display = 'block';
            timerText.style.display = 'none';
        }
    }

    // Funci√≥n 5: El relojito de cuenta regresiva
    function actualizarReloj() {
        if (!cooldownEndTime) return;

        const ahora = new Date();
        const distancia = cooldownEndTime - ahora;

        if (distancia < 0) {
            // El tiempo termin√≥
            actualizarInterfazHome();
            return;
        }

        const minutos = Math.floor((distancia % (1000 * 60 * 60)) / (1000 * 60));
        const segundos = Math.floor((distancia % (1000 * 60)) / 1000);

        timerText.innerText = `Pr√≥xima recarga en: ${minutos}m ${segundos}s`;
    }

    // --- FUNCIONES VISUALES (Popups y cambios de pantalla) ---
    function mostrarAlerta(msg) {
        document.getElementById('popupMsg').innerText = msg;
        document.getElementById('infoPopup').style.display = 'block';
    }
    function cerrarPopup() {
        document.getElementById('infoPopup').style.display = 'none';
    }
    function salirDelJuego() {
        gameScreen.style.display = 'none';
        homeScreen.style.display = 'flex'; // Volver a mostrar flex para centrar
        document.querySelector('.bottom-nav').style.display = 'flex';
        // Detener el loop del juego para ahorrar bater√≠a
        juegoActivo = false; 
    }

    // --- C√ìDIGO DEL JUEGO (EL MINERO) INTEGRADO ---
    // Aqu√≠ pego la l√≥gica del juego anterior, adaptada para funcionar dentro de este sistema
    
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let juegoActivo = false;
    let score = 0;
    let timeLeft = 0;
    
    // Configuraci√≥n del juego (Resumida para integrar)
    let W, H;
    const claw = { x:0, y:50, angle:1.57, len:30, state:'IDLE', item:null };
    let items = [];
    
    function iniciarJuegoReal() {
        homeScreen.style.display = 'none';
        document.querySelector('.bottom-nav').style.display = 'none';
        gameScreen.style.display = 'block';
        
        // Ajustar tama√±o
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
        
        // Resetear variables
        score = 0;
        timeLeft = 60; // 60 segundos por juego
        items = [];
        // Crear items aleatorios
        for(let i=0; i<8; i++) items.push({
            x: Math.random()*(W-40)+20, 
            y: Math.random()*(H/2)+(H/2-50),
            r: 20, val: 50, visible: true, color: '#FCD535'
        });
        
        juegoActivo = true;
        claw.state = 'IDLE';
        loop();
    }

    function loop() {
        if (!juegoActivo) return;
        
        // Fondo
        ctx.fillStyle = '#050510';
        ctx.fillRect(0,0,W,H);
        
        // Tiempo
        timeLeft -= 0.016; // Aprox 60fps
        if (timeLeft <= 0) {
            juegoTerminado(); // Se acab√≥ el tiempo, volvemos al menu y restamos vida
            return;
        }

        // L√≥gica simple de la garra (Resumida)
        if (claw.state === 'IDLE') {
            claw.angle += 0.03;
            if (claw.angle > 2.5 || claw.angle < 0.6) claw.angle -= 0.06; // Oscilar simple (bugfix rapido)
             claw.x = W/2;
        } else if (claw.state === 'SHOOTING') {
            claw.len += 10;
            if (claw.len > H) claw.state = 'RETRACTING';
            // Colision simple
            let tipX = W/2 + Math.cos(claw.angle)*claw.len;
            let tipY = 50 + Math.sin(claw.angle)*claw.len;
            items.forEach(it => {
                if(it.visible && Math.hypot(tipX-it.x, tipY-it.y) < it.r) {
                    claw.item = it;
                    it.visible = false;
                    claw.state = 'RETRACTING';
                }
            });
        } else if (claw.state === 'RETRACTING') {
            claw.len -= 10;
            if (claw.len <= 30) {
                claw.len = 30;
                claw.state = 'IDLE';
                claw.item = null;
            }
        }

        // Dibujar Items
        items.forEach(it => {
            if(it.visible) {
                ctx.fillStyle = it.color;
                ctx.beginPath(); ctx.arc(it.x, it.y, it.r, 0, 7); ctx.fill();
            }
        });

        // Dibujar Garra
        let endX = W/2 + Math.cos(claw.angle)*claw.len;
        let endY = 50 + Math.sin(claw.angle)*claw.len;
        ctx.strokeStyle = 'white'; ctx.lineWidth=2;
        ctx.beginPath(); ctx.moveTo(W/2, 50); ctx.lineTo(endX, endY); ctx.stroke();
        
        // UI dentro del juego
        ctx.fillStyle = 'white'; ctx.font = '20px Arial';
        ctx.fillText("Tiempo: " + Math.ceil(timeLeft), W-120, 40);

        requestAnimationFrame(loop);
    }

    // Click para disparar
    canvas.addEventListener('touchstart', (e) => {
        if(claw.state === 'IDLE') claw.state = 'SHOOTING';
    });
    canvas.addEventListener('mousedown', (e) => {
        if(claw.state === 'IDLE') claw.state = 'SHOOTING';
    });

    // Iniciar
    actualizarInterfazHome();

</script>
</body>
    </html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>IA Studio Elite GOLD</title>
    
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    
    <style>
        :root {
            --ios-bg: #F2F2F7; 
            --ios-card: #FFFFFF;
            --ios-accent: #007AFF; 
            --ios-text: #1C1C1E;
            --ios-secondary: #8E8E93;
            --ios-green: #34C759;
        }

        body { 
            background-color: var(--ios-bg); 
            color: var(--ios-text); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            margin: 0; padding: 20px; 
            display: flex; flex-direction: column; align-items: center;
        }

        .header {
            width: 100%; max-width: 400px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px;
        }

        .badge-credits {
            background: var(--ios-card);
            padding: 10px 20px; border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            font-weight: 800; color: var(--ios-accent);
            font-size: 18px;
        }

        .container {
            width: 100%; max-width: 400px;
            background: var(--ios-card);
            border-radius: 28px; padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.03);
            box-sizing: border-box;
            text-align: center;
        }

        textarea {
            width: 100%; border: none; background: #F3F3F3;
            border-radius: 18px; padding: 18px; font-size: 17px;
            margin-bottom: 20px; resize: none; outline: none; font-family: inherit;
        }

        .btn {
            width: 100%; padding: 18px; border-radius: 16px;
            font-size: 17px; font-weight: 700; border: none;
            cursor: pointer; transition: all 0.2s ease;
            margin-bottom: 12px; display: flex; justify-content: center; align-items: center;
        }

        .btn-main { background-color: var(--ios-accent); color: white; }
        .btn-main:active { transform: scale(0.97); }

        .btn-ads { background-color: #E5E5EA; color: var(--ios-accent); }

        .btn-download {
            background-color: var(--ios-green);
            color: white; display: none; margin-top: 15px;
        }

        /* BARRA DE PROGRESO */
        #progress-container { display: none; margin: 20px 0; }
        .progress-text { font-size: 13px; color: var(--ios-secondary); margin-bottom: 8px; }
        .progress-bar-bg { width: 100%; height: 8px; background: #E5E5EA; border-radius: 10px; overflow: hidden; }
        .progress-bar-fill { width: 0%; height: 100%; background: var(--ios-accent); transition: width 0.4s ease; }
        
        .result-wrapper {
            margin-top: 20px; width: 100%; border-radius: 24px;
            overflow: hidden; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        #resultado { width: 100%; display: block; }
    </style>
</head>
<body>

    <div class="header">
        <h1 style="font-size: 24px; font-weight: 800;">Elite Studio</h1>
        <div class="badge-credits">‚ö° <span id="val-creditos">1000</span></div>
    </div>

    <div class="container">
        <textarea id="prompt" rows="3" placeholder="¬øQu√© vamos a crear hoy?"></textarea>
        
        <button class="btn btn-main" id="btn-gen" onclick="verificarYGenerar()">‚ú® Generar (-10‚ö°)</button>
        <button class="btn btn-ads" onclick="accionAnuncio()">üì∫ +100 Energ√≠a Gratis</button>

        <div id="progress-container">
            <div class="progress-text" id="status-text">Iniciando motores de IA...</div>
            <div class="progress-bar-bg">
                <div class="progress-bar-fill" id="progress-fill"></div>
            </div>
        </div>

        <div class="result-wrapper" id="box-resultado">
            <img id="resultado">
        </div>

        <button class="btn btn-download" id="btn-descarga" onclick="descargarImagen()">
            ‚¨áÔ∏è Descargar Masterpiece
        </button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor("#F2F2F7");

        // --- 1. BIENVENIDA DE 1000 ENERG√çA ---
        let creditos = localStorage.getItem('user_creds_gold') ? parseInt(localStorage.getItem('user_creds_gold')) : 1000;
        let intentos = 0;

        function refrescarUI() {
            document.getElementById('val-creditos').innerText = creditos;
            localStorage.setItem('user_creds_gold', creditos);
            document.getElementById('btn-gen').disabled = (creditos < 10);
        }
        refrescarUI();

        // --- 2. RECOMPENSA DE 100 ENERG√çA ---
        async function accionAnuncio() {
            const AdController = window.Adsgram.init({ blockId: "18897" });
            AdController.show().then(() => {
                creditos += 100; // RECOMPENSA ALTA
                refrescarUI();
                tg.showAlert("‚úÖ ¬°Brutal! Has ganado +100 de Energ√≠a.");
            }).catch(() => {
                // Si falla, intentamos Monetag o damos compensaci√≥n
                creditos += 20; 
                refrescarUI();
                tg.showAlert("Aviso: No hay videos, recibes +20 de cortes√≠a.");
            });
        }

        // --- 3. INTERRUPCI√ìN SORPRESA ---
        function verificarYGenerar() {
            // Hay un 30% de probabilidad de que salte un anuncio antes de generar
            if (Math.random() < 0.30) {
                tg.showConfirm("Anuncio patrocinado para mantener la calidad Elite.", (confirm) => {
                    const AdController = window.Adsgram.init({ blockId: "18897" });
                    AdController.show().finally(() => {
                        iniciarGeneracion();
                    });
                });
            } else {
                iniciarGeneracion();
            }
        }

        function iniciarGeneracion() {
            const p = document.getElementById('prompt').value;
            if(p.length < 2) return tg.showAlert("Describe tu idea.");
            
            // --- 4. COSTO DE 10 ENERG√çA ---
            creditos -= 10; 
            refrescarUI();
            intentos = 0;
            pedirImagen(p);
        }

        function pedirImagen(promptUser) {
            const progressCont = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const statusText = document.getElementById('status-text');
            const box = document.getElementById('box-resultado');
            const btnD = document.getElementById('btn-descarga');
            const img = document.getElementById('resultado');

            progressCont.style.display = "block";
            box.style.display = "none";
            btnD.style.display = "none";
            progressFill.style.width = "15%";
            statusText.innerText = "Conectando con servidores Elite...";

            const seed = Math.floor(Math.random() * 2000000);
            const quality = "High-end ultra-realistic photography, cinematic lighting, 8k, hyper-detailed: ";
            const modelos = ["flux", "turbo", "unity"];
            const modeloActual = modelos[intentos % modelos.length];
            const bypass = Date.now();

            const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(quality + promptUser)}?seed=${seed}&width=1024&height=1024&nologo=true&model=${modeloActual}&cb=${bypass}`;

            img.src = url;

            img.onload = () => {
                // Verificamos si es el aviso amarillo (usualmente muy peque√±o)
                if (img.naturalWidth < 400 && intentos < 2) {
                    intentos++;
                    pedirImagen(promptUser);
                    return;
                }
                
                progressFill.style.width = "100%";
                statusText.innerText = "¬°Arte generado!";
                
                setTimeout(() => {
                    progressCont.style.display = "none";
                    box.style.display = "block";
                    btnD.style.display = "flex";
                    tg.HapticFeedback.notificationOccurred('success');
                }, 500);
            };

            img.onerror = () => {
                if (intentos < 2) {
                    intentos++;
                    pedirImagen(promptUser);
                } else {
                    tg.showAlert("Servidores saturados. Reintentando...");
                    progressCont.style.display = "none";
                }
            };
        }

        function descargarImagen() {
            const imgUrl = document.getElementById('resultado').src;
            tg.showPopup({
                title: 'Descargar Arte',
                message: 'Abre la imagen y mant√©n presionado para guardar en tu galer√≠a.',
                buttons: [{id: 'ok', type: 'default', text: 'Abrir Foto'}]
            }, (id) => {
                if(id === 'ok') tg.openLink(imgUrl);
            });
        }
    </script>
</body>
</html>

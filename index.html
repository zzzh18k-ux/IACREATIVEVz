<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lucky Mines USD</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --green: #00e676;
            --red: #ff1744;
            --blue: #2979ff;
            --text: #ffffff;
            --panel: #2c2c2c;
        }
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; }
        
        body {
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 15px; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* HEADER DE DINERO */
        .wallet-card {
            width: 100%; max-width: 400px; background: linear-gradient(135deg, #1e1e1e, #252525);
            padding: 20px; border-radius: 16px; margin-bottom: 20px;
            border: 1px solid #333; box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            display: flex; justify-content: space-between; align-items: center;
        }
        .balance-group { display: flex; flex-direction: column; }
        .balance-label { font-size: 11px; color: #aaa; letter-spacing: 1px; font-weight: bold; }
        .balance-val { font-family: 'Roboto Mono', monospace; font-size: 32px; font-weight: 700; color: var(--green); text-shadow: 0 0 10px rgba(0, 230, 118, 0.2); }
        
        .target-box { text-align: right; }
        .target-val { font-family: 'Roboto Mono', monospace; font-size: 14px; color: #fff; }

        /* TABLERO */
        .board-container {
            width: 100%; max-width: 380px; aspect-ratio: 1;
            background: var(--panel); padding: 10px; border-radius: 12px;
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
            margin-bottom: 20px; box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }
        .tile {
            background: #3a3a3a; border-radius: 8px; cursor: pointer; position: relative;
            display: flex; justify-content: center; align-items: center; font-size: 28px;
            transition: all 0.1s; border-bottom: 3px solid #222;
        }
        .tile:active { border-bottom: 0px solid #222; transform: translateY(3px); }
        .tile.open-gem { background: #2ecc71; border: none; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 0 15px #2ecc71; }
        .tile.open-bomb { background: #e74c3c; border: none; animation: shake 0.4s; }

        @keyframes pop { 0% { transform: scale(0.0); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* CONTROLES DE APUESTA */
        .control-panel { width: 100%; max-width: 400px; background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        
        .bet-screen {
            background: #000; border: 1px solid #444; border-radius: 8px;
            padding: 10px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
        }
        .bet-val { font-family: 'Roboto Mono', monospace; font-size: 20px; color: white; }
        .btn-mini { background: #333; border: none; color: #ccc; padding: 5px 10px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer; margin-left: 5px; }

        .btn-big {
            width: 100%; padding: 15px; border-radius: 10px; border: none;
            font-size: 18px; font-weight: 900; text-transform: uppercase; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 10px; transition: 0.2s;
        }
        .btn-green { background: var(--green); color: #000; box-shadow: 0 4px 0 #00b359; }
        .btn-green:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-orange { background: #ff9800; color: #000; box-shadow: 0 4px 0 #e65100; display: none; }

        /* GANANCIA FLOTANTE */
        .win-info { text-align: center; height: 25px; margin-bottom: 5px; opacity: 0; font-weight: bold; color: var(--green); }

        /* BOTÃ“N RETIRO */
        .withdraw-btn {
            width: 100%; max-width: 400px; padding: 15px; background: #333; color: #777;
            border: none; border-radius: 10px; font-weight: bold; font-size: 14px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .withdraw-btn.active {
            background: linear-gradient(90deg, #00e676, #00b0ff); color: #000;
            cursor: pointer; animation: pulse 2s infinite; box-shadow: 0 0 20px rgba(0, 230, 118, 0.3);
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* MODALES */
        .modal-wrap { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:99; display:none; justify-content:center; align-items:center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--card); width: 90%; max-width: 320px; padding: 25px; border-radius: 16px; text-align: center; border: 1px solid #444; }

    </style>
</head>
<body>

    <div class="wallet-card">
        <div class="balance-group">
            <div class="balance-label">TU SALDO</div>
            <div class="balance-val" id="balance">$0.00</div>
        </div>
        <div class="target-box">
            <div class="balance-label">META RETIRO</div>
            <div class="target-val" style="color:#2979ff;">$0.25</div>
        </div>
    </div>

    <div class="win-info" id="profitFloat">GANANDO: +$0.00</div>

    <div class="board-container" id="board">
        </div>

    <div class="control-panel">
        <div style="font-size:11px; color:#aaa; margin-bottom:5px; display:flex; justify-content:space-between;">
            <span>APUESTA</span>
            <span>MÃ­n: $0.01</span>
        </div>
        <div class="bet-screen">
            <div class="bet-val" id="betDisplay">$0.01</div>
            <div>
                <button class="btn-mini" onclick="setBet('min')">MIN</button>
                <button class="btn-mini" onclick="setBet('half')">Â½</button>
                <button class="btn-mini" onclick="setBet('double')">2x</button>
                <button class="btn-mini" onclick="setBet('max')">MAX</button>
            </div>
        </div>

        <button class="btn-big btn-green" id="btnPlay" onclick="playGame()">APOSTAR</button>
        <button class="btn-big btn-orange" id="btnCashout" onclick="cashout()">RETIRAR GANANCIA</button>
    </div>

    <button class="withdraw-btn" id="wBtn" onclick="withdraw()">
        <span><i class="fa-solid fa-lock"></i> SALDO INSUFICIENTE</span>
        <span>0%</span>
    </button>
    
    <div style="margin-top:20px; text-align:center;">
        <p style="font-size:11px; color:#555;">Sistema Provably Fair. Multiplicadores de Clase A.</p>
        <button class="btn-mini" style="background:transparent; border:1px solid #444;" onclick="tg.openTelegramLink('https://t.me/noticebuddy')">Canal Oficial</button>
    </div>

    <div class="modal-wrap" id="refillModal">
        <div class="modal-box" style="border-color: #ff1744;">
            <div style="font-size:40px; margin-bottom:10px;">ðŸ“‰</div>
            <h2 style="color:#fff; margin:0;">SALDO AGOTADO</h2>
            <p style="color:#aaa; font-size:13px; margin:15px 0;">Perdiste todo. Mira un video corto para recibir <b>$0.05</b> y seguir jugando.</p>
            <button class="btn-big btn-green" onclick="watchAd('refill')">
                <i class="fa-solid fa-video"></i> OBTENER $0.05
            </button>
        </div>
    </div>

    <div class="modal-wrap" id="successModal">
        <div class="modal-box" style="border-color: var(--green);">
            <div style="font-size:40px; margin-bottom:10px;">ðŸ’¸</div>
            <h2 style="color:var(--green); margin:0;">Â¡META ALCANZADA!</h2>
            <p style="color:#ccc; font-size:13px; margin:15px 0;">Has desbloqueado el retiro mÃ­nimo.</p>
            <div style="background:#000; padding:10px; border-radius:8px; margin-bottom:15px;">
                <div style="color:#aaa; font-size:10px;">MONTO A RETIRAR</div>
                <div style="color:#fff; font-size:20px; font-weight:bold;">$0.25 USD</div>
            </div>
            <button class="btn-big btn-green" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')">ENVIAR CAPTURA</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        tg.setHeaderColor('#121212'); tg.setBackgroundColor('#121212');

        const ADSGRAM_ID = "18897"; 
        const KEY = 'lucky_usd_v1';
        
        // --- CONFIGURACIÃ“N ECONÃ“MICA ---
        const WITHDRAW_TARGET = 0.25; // Meta Real
        const START_BONUS = 0.10;     // Bono inicial
        const AD_REWARD = 0.05;       // CuÃ¡nto das por ver anuncio si pierde
        
        let user = { balance: START_BONUS };
        let currentBet = 0.01;
        
        let isPlaying = false;
        let bombs = [];
        let revealed = 0;
        let currentWin = 0;

        // Multiplicadores agresivos (tipo casino)
        const mults = [1.13, 1.35, 1.60, 2.00, 3.00, 4.50, 7.00, 11.00, 18.00, 25.00, 35.00, 50.00];

        window.onload = function() {
            // Cargar datos
            if(localStorage.getItem(KEY)) {
                try {
                    let data = JSON.parse(atob(localStorage.getItem(KEY)));
                    user.balance = parseFloat(data.balance);
                } catch(e) { user.balance = START_BONUS; }
            } else {
                // Primer uso: Bono
                tg.showPopup({title:"Â¡Bono de Bienvenida!", message:"Has recibido $0.10 gratis para empezar."});
            }
            createGrid();
            updateUI();
        };

        function save() {
            localStorage.setItem(KEY, btoa(JSON.stringify(user)));
            updateUI();
        }

        function updateUI() {
            document.getElementById('balance').innerText = '$' + user.balance.toFixed(2);
            document.getElementById('betDisplay').innerText = '$' + currentBet.toFixed(2);
            
            // Barra Retiro
            let pct = (user.balance / WITHDRAW_TARGET) * 100;
            if(pct > 100) pct = 100;
            
            const wBtn = document.getElementById('wBtn');
            if(user.balance >= WITHDRAW_TARGET) {
                wBtn.classList.add('active');
                wBtn.innerHTML = `<span><i class="fa-solid fa-unlock"></i> Â¡RETIRAR AHORA!</span><span>$${user.balance.toFixed(2)}</span>`;
            } else {
                wBtn.classList.remove('active');
                wBtn.innerHTML = `<span><i class="fa-solid fa-lock"></i> FALTA PARA $0.25</span><span>${pct.toFixed(0)}%</span>`;
            }

            // Chequeo de bancarrota
            if(user.balance < 0.01 && !isPlaying) {
                document.getElementById('refillModal').style.display = 'flex';
            }
        }

        function createGrid() {
            const b = document.getElementById('board'); b.innerHTML = '';
            for(let i=0; i<16; i++) {
                let d = document.createElement('div');
                d.className = 'tile'; d.id = 't-'+i;
                d.onclick = () => tileClick(i);
                b.appendChild(d);
            }
        }

        // --- APUESTAS ---
        function setBet(type) {
            if(isPlaying) return;
            if(type === 'min') currentBet = 0.01;
            if(type === 'double') currentBet *= 2;
            if(type === 'half') currentBet /= 2;
            if(type === 'max') currentBet = user.balance;

            if(currentBet < 0.01) currentBet = 0.01;
            if(currentBet > user.balance) currentBet = user.balance;
            updateUI();
        }

        function playGame() {
            if(user.balance < 0.01) { document.getElementById('refillModal').style.display = 'flex'; return; }
            if(currentBet > user.balance) currentBet = user.balance;
            if(currentBet < 0.01) return;

            user.balance -= currentBet;
            save();

            isPlaying = true;
            revealed = 0;
            currentWin = currentBet;
            bombs = [];
            while(bombs.length < 4) {
                let r = Math.floor(Math.random()*16);
                if(!bombs.includes(r)) bombs.push(r);
            }

            // UI Reset
            document.querySelectorAll('.tile').forEach(t => {
                t.className = 'tile'; t.innerHTML = ''; t.style.background = '#3a3a3a';
            });
            document.getElementById('btnPlay').style.display = 'none';
            document.getElementById('btnCashout').style.display = 'flex';
            document.getElementById('profitFloat').style.opacity = '1';
            updateProfit();
        }

        function tileClick(idx) {
            if(!isPlaying) return;
            let el = document.getElementById('t-'+idx);
            if(el.classList.contains('open-gem')) return;

            if(bombs.includes(idx)) {
                // ðŸ’¥ PERDIÃ“
                el.className = 'tile open-bomb'; el.innerHTML = 'ðŸ’£';
                gameOver();
            } else {
                // ðŸ’Ž GANÃ“
                el.className = 'tile open-gem'; el.innerHTML = 'ðŸ’Ž';
                revealed++;
                let m = mults[revealed-1] || 2.0;
                currentWin = currentBet * m;
                updateProfit();
                tg.HapticFeedback.impactOccurred('light');
                
                if(revealed === 12) cashout(); // GanÃ³ todo
            }
        }

        function updateProfit() {
            document.getElementById('profitFloat').innerText = 'GANANDO: +$' + currentWin.toFixed(2);
            document.getElementById('btnCashout').innerHTML = `RETIRAR <span style="font-size:12px">($${currentWin.toFixed(2)})</span>`;
        }

        function cashout() {
            if(!isPlaying) return;
            isPlaying = false;
            user.balance += currentWin;
            save();
            tg.HapticFeedback.notificationOccurred('success');
            resetBoard();
        }

        function gameOver() {
            isPlaying = false;
            // Mostrar todas las bombas
            bombs.forEach(b => {
                let t = document.getElementById('t-'+b);
                t.className = 'tile open-bomb'; t.innerHTML = 'ðŸ’£';
            });
            tg.HapticFeedback.notificationOccurred('error');
            setTimeout(resetBoard, 1500);
        }

        function resetBoard() {
            document.getElementById('btnPlay').style.display = 'flex';
            document.getElementById('btnCashout').style.display = 'none';
            document.getElementById('profitFloat').style.opacity = '0';
            updateUI();
        }

        // --- SISTEMA DE ANUNCIOS (MONETIZACIÃ“N) ---
        function watchAd(type) {
            const AdController = window.Adsgram.init({ blockId: ADSGRAM_ID });
            AdController.show().then(() => {
                user.balance += AD_REWARD;
                save();
                document.getElementById('refillModal').style.display = 'none';
                tg.showPopup({title:"Â¡Recarga!", message:`Has recibido $${AD_REWARD} para seguir jugando.`});
            }).catch(() => {
                // Fallback a Monetag
                 if (typeof show_10278425 === 'function') {
                    show_10278425().then(()=>{
                         user.balance += AD_REWARD; save();
                         document.getElementById('refillModal').style.display = 'none';
                    });
                } else {
                    tg.showAlert("No hay videos disponibles por ahora.");
                }
            });
        }

        // --- RETIRO REAL ---
        function withdraw() {
            if(user.balance < WITHDRAW_TARGET) {
                tg.showAlert(`Necesitas llegar a $${WITHDRAW_TARGET} para retirar.`);
                return;
            }
            // Resetear balance al cobrar para que tengan que jugar de nuevo
            user.balance = START_BONUS; 
            save();
            document.getElementById('successModal').style.display = 'flex';
        }
    </script>
</body>
    </html>

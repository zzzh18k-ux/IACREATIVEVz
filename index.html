<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Moon Miner Elite</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        body {
            margin: 0;
            padding: 0;
            background-color: #050510;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Orbitron', sans-serif; /* Fuente futurista */
            touch-action: none; /* Evita zoom en celular */
        }

        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 450px; /* Tamaño tipo celular */
            height: 100%;
            max-height: 850px;
            box-shadow: 0 0 50px rgba(0, 200, 255, 0.1);
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at bottom, #1a1a3a 0%, #000000 100%);
        }

        /* Interfaz flotante (UI) */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Dejar pasar los clics al canvas */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            color: #fff;
            text-shadow: 0 0 10px #00ffff;
            font-size: 18px;
            font-weight: bold;
        }

        .score-box, .time-box {
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Pantallas de Inicio y Fin */
        .modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 10;
            pointer-events: auto;
            backdrop-filter: blur(5px);
            transition: opacity 0.3s;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #fdd835;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(253, 216, 53, 0.5);
            text-align: center;
        }

        p {
            font-size: 14px;
            color: #ccc;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
        }

        button {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 18px;
            background: linear-gradient(45deg, #fdd835, #ffb300);
            border: none;
            border-radius: 50px;
            color: #000;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 179, 0, 0.4);
            transition: transform 0.1s;
        }

        button:active {
            transform: scale(0.95);
        }

        /* Iconos simples con CSS */
        .icon-coin {
            width: 20px; height: 20px; background: #fdd835; border-radius: 50%;
            box-shadow: 0 0 5px #fdd835;
        }
        .icon-clock {
            width: 20px; height: 20px; border: 2px solid #fff; border-radius: 50%;
            position: relative;
        }
    </style>
</head>
<body>

<div id="gameContainer">
    <canvas id="gameCanvas"></canvas>

    <div class="ui-layer">
        <div class="top-bar">
            <div class="score-box">
                <div class="icon-coin"></div>
                <span id="scoreDisplay">0</span>
            </div>
            <div class="time-box">
                <div class="icon-clock"></div>
                <span id="timeDisplay">60s</span>
            </div>
        </div>
    </div>

    <div id="startScreen" class="modal">
        <h1>Moon Miner</h1>
        <p>Estás en una misión espacial. Usa el gancho para recolectar minerales.</p>
        <p style="color: #fdd835; margin-top: 10px;">Toque la pantalla para lanzar el gancho.</p>
        <button onclick="startGame()">JUGAR AHORA</button>
    </div>

    <div id="gameOverScreen" class="modal hidden">
        <h1 style="color: #ff4444;">Misión Terminada</h1>
        <p>Tu recolección total fue:</p>
        <h2 id="finalScore" style="font-size: 40px; margin: 20px 0;">0</h2>
        <button onclick="startGame()">INTENTAR DE NUEVO</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Elementos UI
    const scoreDisplay = document.getElementById('scoreDisplay');
    const timeDisplay = document.getElementById('timeDisplay');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const finalScoreDisplay = document.getElementById('finalScore');

    // Ajustar canvas al tamaño real
    let W, H;
    function resize() {
        const container = document.getElementById('gameContainer');
        W = canvas.width = container.clientWidth;
        H = canvas.height = container.clientHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- VARIABLES ---
    let gameRunning = false;
    let score = 0;
    let timeLeft = 60;
    let items = [];
    let particles = []; // Para efectos visuales
    let lastTime = 0;

    // --- CLASES Y OBJETOS ---

    const claw = {
        x: 0, y: 60, // La posición X se actualiza en el loop
        angle: Math.PI / 2,
        angleSpeed: 0.025,
        angleDir: 1,
        length: 30,
        maxLength: 0, // Se calcula en el loop
        state: 'IDLE', // IDLE, SHOOTING, RETRACTING
        caughtItem: null,
        
        draw: function() {
            this.x = W / 2; // Siempre centrado
            this.maxLength = H - 50;

            let endX = this.x + this.length * Math.cos(this.angle);
            let endY = this.y + this.length * Math.sin(this.angle);

            // 1. Dibujar la cuerda (Línea brillante)
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#fdd835';
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(endX, endY);
            ctx.stroke();
            ctx.shadowBlur = 0; // Resetear brillo

            // 2. Dibujar la Garra (Mecánica)
            ctx.save();
            ctx.translate(endX, endY);
            ctx.rotate(this.angle - Math.PI/2);
            
            // Cuerpo de la garra
            ctx.fillStyle = '#ffb300';
            ctx.beginPath();
            ctx.arc(0, 0, 8, 0, Math.PI * 2);
            ctx.fill();

            // Pinzas (se abren o cierran si lleva algo)
            ctx.fillStyle = '#e0e0e0';
            let pincerAngle = this.caughtItem ? 0.2 : 0.6; // Cerrado o abierto
            
            // Pinza izquierda
            ctx.beginPath();
            ctx.moveTo(-5, 0);
            ctx.lineTo(-12, 15);
            ctx.lineTo(-4, 10);
            ctx.fill();
            
            // Pinza derecha
            ctx.beginPath();
            ctx.moveTo(5, 0);
            ctx.lineTo(12, 15);
            ctx.lineTo(4, 10);
            ctx.fill();

            ctx.restore();

            // 3. Dibujar la nave (Base)
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#ff6f00';
            ctx.fillStyle = '#ff6f00'; // Naranja nave
            ctx.beginPath();
            ctx.arc(this.x, this.y - 10, 25, 0, Math.PI * 2);
            ctx.fill();
            // Detalle cabina
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(this.x, this.y - 10, 10, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;

            return { x: endX, y: endY };
        },

        update: function() {
            if (this.state === 'IDLE') {
                this.angle += this.angleSpeed * this.angleDir;
                if (this.angle > Math.PI - 0.5 || this.angle < 0.5) this.angleDir *= -1;
            } else if (this.state === 'SHOOTING') {
                this.length += 12; // Velocidad de disparo rápida
                if (this.length >= this.maxLength) this.state = 'RETRACTING';
            } else if (this.state === 'RETRACTING') {
                let speed = 12;
                if (this.caughtItem) speed = 12 / this.caughtItem.weight;
                this.length -= speed;
                if (this.length <= 30) {
                    this.length = 30;
                    this.state = 'IDLE';
                    if (this.caughtItem) {
                        collectItem(this.caughtItem);
                        this.caughtItem = null;
                    }
                }
            }
        }
    };

    class Item {
        constructor() {
            this.reset();
        }

        reset() {
            this.x = Math.random() * (W - 60) + 30;
            this.y = Math.random() * (H / 2) + (H / 2 - 50);
            this.visible = true;
            
            // Tipos de objetos aleatorios
            let rand = Math.random();
            if (rand < 0.2) { // Roca (20%)
                this.type = 'rock';
                this.radius = 25;
                this.value = 15;
                this.weight = 3.5;
                this.color1 = '#5d4037';
                this.color2 = '#3e2723';
            } else if (rand < 0.3) { // Gema (10%)
                this.type = 'gem';
                this.radius = 12;
                this.value = 150;
                this.weight = 1;
                this.color1 = '#ff4081';
                this.color2 = '#c51162';
            } else { // Oro (70%)
                this.type = 'gold';
                this.radius = 18;
                this.value = 50;
                this.weight = 1.5;
                this.color1 = '#ffeb3b'; // Amarillo brillante
                this.color2 = '#f57f17'; // Naranja sombra
            }
        }

        draw(x, y) {
            if (!this.visible) return;
            
            let drawX = x || this.x;
            let drawY = y || this.y;

            // Dibujar como Esfera 3D usando gradientes
            let grad = ctx.createRadialGradient(drawX - this.radius/3, drawY - this.radius/3, this.radius/4, drawX, drawY, this.radius);
            grad.addColorStop(0, this.color1);
            grad.addColorStop(1, this.color2);
            
            ctx.fillStyle = grad;
            ctx.shadowBlur = 10;
            ctx.shadowColor = this.color1; // Resplandor
            ctx.beginPath();
            ctx.arc(drawX, drawY, this.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;

            // Brillo extra para gemas
            if (this.type === 'gem') {
                ctx.fillStyle = 'rgba(255,255,255,0.6)';
                ctx.beginPath();
                ctx.arc(drawX - 5, drawY - 5, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }
    }

    // Efecto de partículas cuando recoges puntos
    class Particle {
        constructor(x, y) {
            this.x = x; this.y = y;
            this.vx = (Math.random() - 0.5) * 4;
            this.vy = (Math.random() - 0.5) * 4;
            this.life = 1.0;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.life -= 0.05;
        }
        draw() {
            ctx.globalAlpha = this.life;
            ctx.fillStyle = '#fff';
            ctx.fillRect(this.x, this.y, 3, 3);
            ctx.globalAlpha = 1.0;
        }
    }

    // --- FUNCIONES DEL JUEGO ---

    function initGame() {
        items = [];
        for (let i = 0; i < 8; i++) items.push(new Item());
        particles = [];
        score = 0;
        timeLeft = 60;
        updateUI();
    }

    function startGame() {
        startScreen.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
        initGame();
        gameRunning = true;
        claw.state = 'IDLE';
        claw.length = 30;
        claw.caughtItem = null;
        lastTime = performance.now();
        requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        gameRunning = false;
        finalScoreDisplay.innerText = score;
        gameOverScreen.classList.remove('hidden');
    }

    function collectItem(item) {
        score += item.value;
        item.reset(); // Reaparecer el ítem en otro lugar
        
        // Crear explosión de partículas
        for(let i=0; i<10; i++) particles.push(new Particle(claw.x, claw.y));
        
        updateUI();
    }

    function updateUI() {
        scoreDisplay.innerText = score;
        timeDisplay.innerText = Math.ceil(timeLeft) + 's';
    }

    // --- BUCLE PRINCIPAL ---

    function gameLoop(now) {
        if (!gameRunning) return;

        let dt = (now - lastTime) / 1000;
        lastTime = now;

        // Temporizador
        timeLeft -= dt;
        if (timeLeft <= 0) {
            timeLeft = 0;
            gameOver();
            return;
        }
        updateUI();

        // Limpiar
        ctx.clearRect(0, 0, W, H);

        // Dibujar Estrellas de fondo (Simple efecto)
        ctx.fillStyle = 'white';
        for(let i=0; i<50; i++) {
            let sx = (Math.sin(i * 132) * W + W) % W;
            let sy = (Math.cos(i * 53) * H + H) % H;
            ctx.globalAlpha = Math.random() * 0.5 + 0.2;
            ctx.fillRect(sx, sy, 2, 2);
        }
        ctx.globalAlpha = 1.0;

        // Actualizar Garra
        claw.update();

        // Colisiones
        if (claw.state === 'SHOOTING') {
            let tip = { x: claw.x + claw.length * Math.cos(claw.angle), y: claw.y + claw.length * Math.sin(claw.angle) };
            
            // Verificar si toca bordes
            if (tip.x < 0 || tip.x > W || tip.y > H) {
                claw.state = 'RETRACTING';
            }

            // Verificar si toca ítem
            for (let item of items) {
                let dx = tip.x - item.x;
                let dy = tip.y - item.y;
                let dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < item.radius + 5) {
                    claw.caughtItem = item;
                    item.visible = false; // Ocultar de su posición original
                    claw.state = 'RETRACTING';
                    break;
                }
            }
        }

        // Dibujar Ítems (los que no están atrapados)
        items.forEach(item => {
            if (item.visible) item.draw();
        });

        // Dibujar Garra
        let tipPos = claw.draw();

        // Dibujar ítem atrapado en la punta
        if (claw.caughtItem) {
            claw.caughtItem.draw(tipPos.x, tipPos.y);
        }

        // Partículas
        particles.forEach((p, index) => {
            p.update();
            p.draw();
            if (p.life <= 0) particles.splice(index, 1);
        });

        requestAnimationFrame(gameLoop);
    }

    // --- CONTROL ---
    window.addEventListener('mousedown', () => {
        if (gameRunning && claw.state === 'IDLE') claw.state = 'SHOOTING';
    });
    window.addEventListener('touchstart', (e) => {
        // e.preventDefault();
        if (gameRunning && claw.state === 'IDLE') claw.state = 'SHOOTING';
    }, {passive: false});

</script>

</body>
            </html>

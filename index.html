<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>IA Studio Elite</title>
    
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* COLORES CREMA Y ESTILO IPHONE */
        :root {
            --ios-bg: #F2F2F7; /* Crema/Gris claro de iOS */
            --ios-card: #FFFFFF;
            --ios-accent: #007AFF; /* Azul Apple */
            --ios-text: #1C1C1E;
            --ios-secondary: #8E8E93;
        }

        body { 
            background-color: var(--ios-bg); 
            color: var(--ios-text); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
        }

        /* Encabezado */
        .header {
            width: 100%;
            max-width: 400px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 5px;
        }

        .header h1 { font-size: 24px; font-weight: 700; margin: 0; }

        .badge-credits {
            background: var(--ios-card);
            padding: 6px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            font-weight: 600;
            color: var(--ios-accent);
            border: 1px solid rgba(0,0,0,0.05);
        }

        /* Contenedor Principal */
        .container {
            width: 100%;
            max-width: 400px;
            background: var(--ios-card);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.03);
            box-sizing: border-box;
        }

        textarea {
            width: 100%;
            border: none;
            background: #F9F9F9;
            border-radius: 15px;
            padding: 15px;
            font-size: 16px;
            font-family: inherit;
            margin-bottom: 20px;
            resize: none;
            box-sizing: border-box;
            outline: none;
            color: #333;
        }

        /* Botones iPhone */
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn-main {
            background-color: var(--ios-accent);
            color: white;
        }

        .btn-main:active { transform: scale(0.97); opacity: 0.9; }

        .btn-ads {
            background-color: #E5E5EA;
            color: var(--ios-accent);
        }

        .btn-ads:active { transform: scale(0.97); background-color: #D1D1D6; }

        .btn:disabled { background-color: #D1D1D6; color: #8E8E93; cursor: not-allowed; }

        /* Area de Imagen */
        #loader { display: none; color: var(--ios-secondary); margin: 15px 0; font-size: 14px; }
        
        .result-wrapper {
            margin-top: 15px;
            width: 100%;
            border-radius: 20px;
            overflow: hidden;
            display: none;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        #resultado { width: 100%; display: block; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Studio Elite</h1>
        <div class="badge-credits">
            ⚡ <span id="val-creditos">3</span>
        </div>
    </div>

    <div class="container">
        <textarea id="prompt" rows="4" placeholder="Describe tu obra maestra..."></textarea>
        
        <button class="btn btn-main" id="btn-gen" onclick="accionGenerar()">
            Generar Imagen (1⚡)
        </button>
        
        <button class="btn btn-ads" onclick="accionAnuncio()">
            Cargar Energía Gratis
        </button>

        <center>
            <div id="loader">Procesando con IA de lujo...</div>
        </center>

        <div class="result-wrapper" id="box-resultado">
            <img id="resultado">
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
        
        // Configuramos el color de la barra de Telegram para que combine
        tg.setHeaderColor("#F2F2F7");

        // Inicializar con 3 créditos
        let creditos = localStorage.getItem('user_creds') ? parseInt(localStorage.getItem('user_creds')) : 3;
        
        function refrescarUI() {
            document.getElementById('val-creditos').innerText = creditos;
            localStorage.setItem('user_creds', creditos);
            document.getElementById('btn-gen').disabled = (creditos <= 0);
        }
        refrescarUI();

        // --- LÓGICA DE ANUNCIOS ---
        async function accionAnuncio() {
            const AdController = window.Adsgram.init({ blockId: "18897" });
            
            AdController.show().then((result) => {
                // Éxito: Vio el video
                creditos += 2;
                refrescarUI();
                tg.showAlert("✅ ¡Excelente! Recibiste +2 de Energía.");
            }).catch((err) => {
                // Fallo: No hay video o error
                // REGALO DE CORTESÍA para que no se rinda el usuario
                creditos += 1;
                refrescarUI();
                tg.showAlert("No hay videos ahora, pero te regalamos +1⚡ por intentar.");
            });
        }

        function accionGenerar() {
            const promptInput = document.getElementById('prompt').value;
            if(promptInput.length < 3) return tg.showAlert("Por favor, escribe una idea.");
            
            creditos -= 1;
            refrescarUI();
            
            const loader = document.getElementById('loader');
            const box = document.getElementById('box-resultado');
            const img = document.getElementById('resultado');
            
            loader.style.display = "block";
            box.style.display = "none";

            // PROMPT MEJORADO para que la IA no haga "basura"
            // Le añadimos términos de alta calidad automáticamente
            const mejorPrompt = `High-end professional digital art, masterpiece, 8k resolution, cinematic lighting, sharp details, luxury aesthetic: ${promptInput}`;
            
            const seed = Math.floor(Math.random() * 888888);
            const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(mejorPrompt)}?seed=${seed}&width=1024&height=1024&nologo=true&model=flux`;

            img.src = url;
            
            img.onload = () => {
                loader.style.display = "none";
                box.style.display = "block";
                tg.HapticFeedback.notificationOccurred('success'); // Vibración de iPhone
            };

            img.onerror = () => {
                loader.innerText = "Error al conectar. Intenta de nuevo.";
            };
        }
    </script>
</body>
</html>

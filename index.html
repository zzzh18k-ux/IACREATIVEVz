<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Diamond Stake PRO</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --bg: #0d1117; /* Fondo oscuro elegante */
            --card: #161b22;
            --accent: #2ecc71; /* Verde Dinero */
            --accent-hover: #27ae60;
            --danger: #e74c3c;
            --input-bg: #000000;
            --text: #e6edf3;
            --btn-sec: #30363d;
        }
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; }
        
        body {
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 15px; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
        }

        /* HEADER SALDO */
        .top-bar {
            width: 100%; max-width: 400px; display: flex; justify-content: space-between; align-items: center;
            background: var(--card); padding: 10px 15px; border-radius: 12px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid #30363d;
        }
        .balance-label { font-size: 11px; color: #8b949e; font-weight: bold; letter-spacing: 1px; }
        .balance-amount { font-size: 20px; font-weight: 900; color: var(--text); display: flex; align-items: center; gap: 5px; }
        .currency-icon { color: #f1c40f; }

        /* TABLERO */
        .game-board {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
            width: 100%; max-width: 380px; margin-bottom: 20px;
        }
        .tile {
            aspect-ratio: 1; background: #21262d; border-radius: 8px; cursor: pointer;
            display: flex; justify-content: center; align-items: center; font-size: 24px;
            box-shadow: inset 0 -3px 0 rgba(0,0,0,0.3); transition: 0.1s;
        }
        .tile:active { transform: scale(0.95); }
        .tile.revealed-gem { background: #238636; border: 1px solid #2ea043; animation: pop 0.3s; box-shadow: 0 0 15px rgba(46, 160, 67, 0.4); }
        .tile.revealed-bomb { background: #da3633; border: 1px solid #f85149; animation: shake 0.4s; }
        
        @keyframes pop { 0% { transform: scale(0.5); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* CONTROLES DE APUESTA */
        .controls-area { width: 100%; max-width: 380px; background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid #30363d; }
        
        .bet-input-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; }
        .bet-label { font-size: 12px; color: #8b949e; display: flex; justify-content: space-between; }
        
        .bet-input-row { display: flex; gap: 5px; height: 50px; }
        
        .bet-display {
            flex: 2; background: var(--input-bg); border: 1px solid #30363d; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; font-weight: bold; color: white; position: relative;
        }
        .bet-display::before { content: '$'; color: var(--accent); position: absolute; left: 15px; font-size: 16px; }

        .btn-ctrl {
            flex: 1; background: var(--btn-sec); border: none; border-radius: 8px; color: #c9d1d9;
            font-weight: bold; font-size: 14px; cursor: pointer; transition: 0.2s;
        }
        .btn-ctrl:active { background: #484f58; transform: translateY(2px); }

        /* BOTÃ“N PRINCIPAL */
        .btn-action {
            width: 100%; padding: 18px; border-radius: 10px; border: none; font-size: 16px; font-weight: 900;
            cursor: pointer; text-transform: uppercase; transition: 0.2s;
            display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .btn-bet { background: var(--accent); color: #052e16; box-shadow: 0 4px 0 #238636; }
        .btn-bet:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-cashout { background: #f39c12; color: #3e2723; box-shadow: 0 4px 0 #d35400; display: none; }
        .btn-cashout:active { transform: translateY(4px); box-shadow: none; }

        /* INFO DE GANANCIA FLOTANTE */
        .profit-info {
            text-align: center; margin-bottom: 10px; height: 40px; opacity: 0; transition: opacity 0.3s;
        }
        .profit-val { color: var(--accent); font-size: 24px; font-weight: 900; text-shadow: 0 0 10px rgba(46, 204, 113, 0.3); }

        /* BOTONES EXTRA */
        .footer-btns { display: flex; gap: 10px; width: 100%; max-width: 380px; margin-top: 15px; }
        .btn-small { flex: 1; padding: 12px; background: #21262d; border: 1px solid #30363d; color: #8b949e; border-radius: 8px; font-size: 12px; font-weight: bold; }

        /* MODALES */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:100; display:none; justify-content:center; align-items:center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--card); padding: 25px; border-radius: 15px; width: 85%; max-width: 320px; text-align: center; border: 1px solid #30363d; }
        .modal-title { font-size: 24px; margin: 10px 0; font-weight: 900; }
        .btn-full { width: 100%; padding: 14px; border-radius: 8px; border: none; font-weight: bold; font-size: 16px; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="top-bar">
        <div>
            <div class="balance-label">TU SALDO</div>
            <div class="balance-amount"><i class="fa-solid fa-coins currency-icon"></i> <span id="balanceDisplay">100.00</span></div>
        </div>
        <div style="text-align:right;">
            <div class="balance-label">RETIRO</div>
            <div style="font-size:12px; color:#2ecc71; font-weight:bold;">$1,000.00</div>
        </div>
    </div>

    <div class="profit-info" id="profitInfo">
        <span style="font-size:12px; color:#aaa;">GANANCIA ACTUAL</span><br>
        <span class="profit-val" id="currentProfit">+$0.00</span>
    </div>

    <div class="game-board" id="board"></div>

    <div class="controls-area">
        <div class="bet-input-group">
            <div class="bet-label">
                <span>MONTO DE APUESTA</span>
                <span>Max: $100</span>
            </div>
            <div class="bet-input-row">
                <button class="btn-ctrl" onclick="adjustBet('half')">Â½</button>
                <div class="bet-display" id="betAmount">10.00</div>
                <button class="btn-ctrl" onclick="adjustBet('double')">x2</button>
                <button class="btn-ctrl" style="flex:0.5; font-size:10px;" onclick="adjustBet('max')">MAX</button>
            </div>
        </div>

        <button class="btn-action btn-bet" id="btnBet" onclick="startGame()">
            APOSTAR
        </button>
        <button class="btn-action btn-cashout" id="btnCashout" onclick="cashout()">
            RETIRAR GANANCIA
        </button>
    </div>

    <div class="footer-btns">
        <button class="btn-small" onclick="watchAdBonus()"><i class="fa-solid fa-play"></i> BONO +$50</button>
        <button class="btn-small" onclick="tg.openTelegramLink('https://t.me/AtencionYougamefavoriteBot')"><i class="fa-solid fa-headset"></i> RETIRAR</button>
    </div>

    <div class="modal-overlay" id="loseModal">
        <div class="modal-box">
            <div style="font-size:50px;">ðŸ’¥</div>
            <div class="modal-title" style="color:var(--danger)">Â¡EXPLOSIÃ“N!</div>
            <p style="color:#8b949e; font-size:14px;">La bomba ha detonado y perdiste tu apuesta.</p>
            <button class="btn-full" style="background:#3742fa; color:white;" onclick="reviveAd()">
                <i class="fa-solid fa-video"></i> REVIVIR (GRATIS)
            </button>
            <button style="background:none; border:none; color:#555; margin-top:10px; text-decoration:underline;" onclick="closeModal()">Perder</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        tg.setHeaderColor('#0d1117'); tg.setBackgroundColor('#0d1117');

        // CONF
        const ADSGRAM_ID = "18897"; 
        const KEY = 'stake_pro_v2';
        const WITHDRAW_LIMIT = 1000; // Meta en "DÃ³lares" virtuales para retiro real

        let user = { balance: 100.00 }; // Saldo inicial
        let currentBet = 10.00;
        
        let gameActive = false;
        let bombs = [];
        let revealedCount = 0;
        let currentWin = 0;

        // Multiplicadores (Stake style)
        const mults = [1.13, 1.35, 1.60, 2.00, 3.00, 4.50, 7.00, 11.00, 18.00, 25.00, 35.00, 50.00];

        window.onload = function() {
            if(localStorage.getItem(KEY)) {
                try { user = JSON.parse(atob(localStorage.getItem(KEY))); } catch(e){}
            }
            createBoard();
            updateUI();
        };

        function save() { localStorage.setItem(KEY, btoa(JSON.stringify(user))); updateUI(); }

        function updateUI() {
            document.getElementById('balanceDisplay').innerText = user.balance.toFixed(2);
            document.getElementById('betAmount').innerText = currentBet.toFixed(2);
        }

        function createBoard() {
            const b = document.getElementById('board'); b.innerHTML = '';
            for(let i=0; i<16; i++){
                let d = document.createElement('div');
                d.className = 'tile'; d.id = 't-'+i;
                d.onclick = () => clickTile(i);
                b.appendChild(d);
            }
        }

        // --- APUESTAS ---
        function adjustBet(type) {
            if(gameActive) return; // No cambiar durante el juego
            if(type === 'double') currentBet *= 2;
            if(type === 'half') currentBet /= 2;
            if(type === 'max') currentBet = user.balance;

            // LÃ­mites
            if(currentBet < 1) currentBet = 1.00;
            if(currentBet > user.balance) currentBet = user.balance;
            if(currentBet > 100) currentBet = 100; // LÃ­mite por mano
            
            updateUI();
        }

        function startGame() {
            if(user.balance < currentBet || currentBet <= 0) {
                tg.showAlert("Saldo insuficiente. Mira el Bono +$50.");
                return;
            }

            user.balance -= currentBet;
            save();

            gameActive = true;
            revealedCount = 0;
            currentWin = currentBet;
            bombs = [];
            while(bombs.length < 4) {
                let r = Math.floor(Math.random()*16);
                if(!bombs.includes(r)) bombs.push(r);
            }

            // UI Reset
            document.querySelectorAll('.tile').forEach(t => {
                t.className = 'tile'; t.innerHTML = ''; t.style.background = '#21262d';
            });
            document.getElementById('btnBet').style.display = 'none';
            document.getElementById('btnCashout').style.display = 'flex';
            document.querySelector('.controls-area').style.borderColor = '#f39c12'; // Alerta visual
            
            document.getElementById('profitInfo').style.opacity = '1';
            updateProfitDisplay();
        }

        function clickTile(idx) {
            if(!gameActive) return;
            let t = document.getElementById('t-'+idx);
            if(t.classList.contains('revealed-gem')) return;

            if(bombs.includes(idx)) {
                // BOMBA
                t.classList.add('revealed-bomb');
                t.innerHTML = 'ðŸ’£';
                gameOver();
            } else {
                // GEMA
                t.classList.add('revealed-gem');
                t.innerHTML = 'ðŸ’Ž';
                tg.HapticFeedback.impactOccurred('light');
                
                revealedCount++;
                let m = mults[revealedCount-1] || 50;
                currentWin = currentBet * m;
                updateProfitDisplay();
                
                if(revealedCount === 12) cashout(); // GanÃ³ todo
            }
        }

        function updateProfitDisplay() {
            document.getElementById('currentProfit').innerText = "+$" + currentWin.toFixed(2);
            document.getElementById('btnCashout').innerText = `RETIRAR $${currentWin.toFixed(2)}`;
        }

        function cashout() {
            if(!gameActive) return;
            gameActive = false;
            
            user.balance += currentWin;
            save();
            
            tg.HapticFeedback.notificationOccurred('success');
            resetGameUI();
        }

        function gameOver() {
            gameActive = false;
            // Mostrar todas
            bombs.forEach(b => {
                let t = document.getElementById('t-'+b);
                t.classList.add('revealed-bomb'); t.innerHTML = 'ðŸ’£';
            });
            setTimeout(() => { document.getElementById('loseModal').style.display = 'flex'; }, 500);
        }

        function resetGameUI() {
            document.getElementById('btnBet').style.display = 'flex';
            document.getElementById('btnCashout').style.display = 'none';
            document.querySelector('.controls-area').style.borderColor = '#30363d';
            document.getElementById('profitInfo').style.opacity = '0';
        }

        function closeModal() {
            document.getElementById('loseModal').style.display = 'none';
            resetGameUI();
        }

        // --- ADS ---
        function reviveAd() {
            const AdController = window.Adsgram.init({ blockId: ADSGRAM_ID });
            AdController.show().then(() => {
                // Devolvemos la apuesta
                user.balance += currentBet;
                save();
                closeModal();
                tg.showPopup({title:"Â¡Salvado!", message:"Se te devolviÃ³ el monto de la apuesta."});
            }).catch(()=>{ tg.showAlert("Error al cargar anuncio."); });
        }

        function watchAdBonus() {
            const AdController = window.Adsgram.init({ blockId: ADSGRAM_ID });
            AdController.show().then(() => {
                user.balance += 50.00;
                save();
                tg.showPopup({title:"Â¡Bono Recibido!", message:"Has recibido $50.00 de saldo de juego."});
            }).catch(()=>{ 
                if (typeof show_10278425 === 'function') {
                    show_10278425().then(()=>{
                         user.balance += 50.00; save(); tg.showPopup({title:"Bono", message:"+$50.00"});
                    });
                } else { tg.showAlert("No hay anuncios."); }
            });
        }
    </script>
</body>
    </html>

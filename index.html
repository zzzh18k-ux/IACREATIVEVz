<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neon Snake Crypto</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10278425' data-sdk='show_10278425'></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root { 
            --bg-dark: #0f0c29;
            --bg-gradient: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            --neon-green: #39ff14;
            --neon-pink: #ff00ff;
            --neon-blue: #00ffff;
            --text: #ffffff;
        }
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: none; }
        
        body {
            background: var(--bg-gradient); color: var(--text); font-family: 'Rajdhani', sans-serif;
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; 
            padding: 10px; overflow: hidden; margin: 0;
        }

        /* UI SUPERIOR */
        .top-ui {
            width: 100%; max-width: 400px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            padding: 10px 20px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 15px; box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }
        .score-box { text-align: center; }
        .score-lbl { font-size: 10px; color: var(--neon-blue); letter-spacing: 2px; text-transform: uppercase; }
        .score-val { font-family: 'Fredoka One', cursive; font-size: 28px; color: white; text-shadow: 0 0 10px var(--neon-blue); }

        /* CANVAS DEL JUEGO */
        .game-wrapper {
            position: relative;
            padding: 4px;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue));
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.4);
            margin-bottom: 15px;
        }
        canvas {
            background: #000; border-radius: 8px; display: block;
            image-rendering: pixelated;
        }

        /* MENSAJE DE START / GAME OVER */
        #overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border-radius: 8px; z-index: 10;
        }
        .overlay-title { font-family: 'Fredoka One'; font-size: 30px; color: var(--neon-green); margin-bottom: 10px; text-shadow: 0 0 10px var(--neon-green); }
        .btn-start {
            background: transparent; border: 2px solid var(--neon-pink); color: white;
            padding: 10px 30px; font-size: 18px; font-family: 'Rajdhani'; font-weight: bold;
            border-radius: 50px; cursor: pointer; box-shadow: 0 0 15px var(--neon-pink);
            transition: 0.2s; text-transform: uppercase;
        }
        .btn-start:active { transform: scale(0.95); background: var(--neon-pink); }

        /* BARRA DE ENERG√çA */
        .stats-container { width: 100%; max-width: 400px; margin-bottom: 10px; }
        .energy-bar-bg { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .energy-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #ff9966, #ff5e62); transition: width 0.3s; box-shadow: 0 0 10px #ff5e62; }
        .energy-txt { font-size: 12px; display: flex; justify-content: space-between; margin-bottom: 3px; color: #aaa; }

        /* BOTONES DE ACCI√ìN */
        .action-row { display: flex; gap: 10px; width: 100%; max-width: 400px; }
        .btn-action {
            flex: 1; padding: 12px; border: none; border-radius: 10px;
            background: rgba(255,255,255,0.05); color: white; font-weight: bold;
            cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px;
            font-size: 11px; border: 1px solid rgba(255,255,255,0.1); transition: 0.2s;
        }
        .btn-action:active { background: rgba(255,255,255,0.15); transform: translateY(2px); }
        .btn-action i { font-size: 18px; margin-bottom: 2px; }
        
        .c-ads { color: var(--neon-blue); text-shadow: 0 0 5px var(--neon-blue); }
        .c-cash { color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green); }

        /* RETIRO */
        .withdraw-btn {
            width: 100%; max-width: 400px; padding: 15px; margin-top: 10px;
            background: #2d3436; color: #7f8c8d; border: none; border-radius: 12px;
            font-weight: 900; font-size: 16px; cursor: not-allowed;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .withdraw-btn.ready {
            background: var(--neon-green); color: black; cursor: pointer;
            box-shadow: 0 0 20px var(--neon-green); animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* BAN SCREEN & MODAL */
        #banScreen { position: fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:9999; display:none; color:red; align-items:center; justify-content:center; }
        
        /* Controles m√≥viles visuales (opcional si swipe falla) */
        .d-pad-hint {
            font-size: 10px; color: rgba(255,255,255,0.3); margin-top: 5px; text-align: center;
        }
    </style>
</head>
<body>

    <div id="banScreen"><h1>‚õî ACCESO DENEGADO</h1></div>

    <div class="top-ui">
        <div class="score-box">
            <div class="score-lbl">PUNTUACI√ìN</div>
            <div class="score-val" id="score">0</div>
        </div>
        <div class="score-box" style="text-align:right;">
            <div class="score-lbl">META: $0.10</div>
            <div style="font-size:12px; color:#aaa;" id="progText">0%</div>
        </div>
    </div>

    <div class="game-wrapper">
        <canvas id="gameCanvas" width="320" height="320"></canvas>
        <div id="overlay">
            <div class="overlay-title" id="overlayTitle">NEON SNAKE</div>
            <p style="color:#aaa; font-size:12px; margin-bottom:15px; text-align:center;">Desliza para moverte<br>Comer = -1 Energ√≠a / +5 Puntos</p>
            <button class="btn-start" onclick="startGame()">JUGAR</button>
        </div>
    </div>

    <div class="stats-container">
        <div class="energy-txt">
            <span><i class="fa-solid fa-bolt" style="color:#ff9966"></i> ENERG√çA</span>
            <span id="energyText">100/100</span>
        </div>
        <div class="energy-bar-bg"><div class="energy-fill" id="energyBar"></div></div>
    </div>

    <div class="action-row">
        <button class="btn-action" onclick="watchAd('adsgram')">
            <i class="fa-solid fa-play c-ads"></i> +15 ENERG√çA
        </button>
        <button class="btn-action" onclick="watchAd('monetag')">
            <i class="fa-solid fa-video c-ads"></i> +10 ENERG√çA
        </button>
        <button class="btn-action" onclick="tg.openTelegramLink('https://t.me/noticebuddy')">
            <i class="fa-brands fa-telegram"></i> CANAL
        </button>
    </div>

    <button class="withdraw-btn" id="withdrawBtn" onclick="retirar()">
        <i class="fa-solid fa-lock"></i> META NO ALCANZADA
    </button>

    <div class="d-pad-hint">Usa las flechas (PC) o desliza el dedo (M√≥vil)</div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        tg.setHeaderColor('#0f0c29'); tg.setBackgroundColor('#0f0c29');

        // CONFIGURACI√ìN
        const ADSGRAM_ID = "18897"; 
        const KEY = 'snake_neon_v1';
        const META = 20000;
        
        // ESTADO DEL USUARIO
        let user = { pts: 0, energy: 100 };
        
        // VARIABLES DEL JUEGO
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 20; // Tama√±o de cada cuadrito
        let tileCount = canvas.width / gridSize;
        
        let scoreGame = 0;
        let snake = [];
        let food = {x: 10, y: 10};
        let dx = 0;
        let dy = 0;
        let gameInterval;
        let isPlaying = false;

        // --- SISTEMA DE GUARDADO ---
        function loadUser() {
            let data = localStorage.getItem(KEY);
            if(data) {
                try { user = JSON.parse(atob(data)); } catch(e){ console.log("Error load"); }
            }
            // Validaci√≥n de multicuenta simple
            let cid = tg.initDataUnsafe?.user?.id || 12345;
            let sid = localStorage.getItem('did');
            if(sid && sid != cid) document.getElementById('banScreen').style.display = 'flex';
            if(!sid) localStorage.setItem('did', cid);
            
            updateUI();
        }

        function saveUser() {
            localStorage.setItem(KEY, btoa(JSON.stringify(user)));
            updateUI();
        }

        function updateUI() {
            document.getElementById('score').innerText = user.pts;
            document.getElementById('energyText').innerText = `${user.energy}/100`;
            document.getElementById('energyBar').style.width = `${Math.min(user.energy, 100)}%`;
            
            let pct = Math.floor((user.pts / META) * 100);
            if(pct > 100) pct = 100;
            document.getElementById('progText').innerText = pct + "%";

            const btn = document.getElementById('withdrawBtn');
            if(user.pts >= META) {
                btn.classList.add('ready');
                btn.innerHTML = '<i class="fa-solid fa-sack-dollar"></i> RETIRAR $0.10';
            } else {
                btn.classList.remove('ready');
                btn.innerHTML = `<i class="fa-solid fa-lock"></i> FALTA POCO`;
            }
        }

        // --- L√ìGICA DEL JUEGO (SNAKE) ---
        
        function startGame() {
            if(user.energy <= 0) {
                tg.showAlert("¬°Sin energ√≠a! Ve un video para recargar.");
                return;
            }
            if(isPlaying) return;

            // Resetear variables
            snake = [{x: 10, y: 10}, {x:9, y:10}, {x:8, y:10}];
            scoreGame = 0;
            dx = 1; dy = 0; // Empieza movi√©ndose a la derecha
            createFood();
            
            isPlaying = true;
            document.getElementById('overlay').style.display = 'none';
            
            // Velocidad del juego (100ms)
            clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, 100);
        }

        function gameLoop() {
            // Mover cabeza
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // 1. Chocar con paredes
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                gameOver();
                return;
            }

            // 2. Chocar consigo mismo
            for (let i = 0; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    gameOver();
                    return;
                }
            }

            snake.unshift(head); // A√±adir nueva cabeza

            // 3. Comer comida
            if (head.x === food.x && head.y === food.y) {
                // L√≥gica de recompensa
                if(user.energy > 0) {
                    user.pts += 5;   // Gana puntos
                    user.energy -= 1; // Gasta energ√≠a por el esfuerzo
                    saveUser();
                    createFood();
                    tg.HapticFeedback.impactOccurred('light');
                } else {
                    // Si se acaba la energ√≠a en medio del juego
                    gameOver();
                    tg.showAlert("Te quedaste sin energ√≠a en media partida.");
                }
            } else {
                snake.pop(); // Eliminar cola si no comi√≥
            }

            draw();
        }

        function draw() {
            // Limpiar
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dibujar Comida (Neon)
            ctx.shadowBlur = 15;
            ctx.shadowColor = "#ff00ff";
            ctx.fillStyle = "#ff00ff";
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);

            // Dibujar Serpiente (Arcoiris)
            for (let i = 0; i < snake.length; i++) {
                ctx.shadowBlur = 10;
                // Color din√°mico basado en la posici√≥n
                let hue = (i * 10 + Date.now()/20) % 360; 
                let color = `hsl(${hue}, 100%, 50%)`;
                
                ctx.shadowColor = color;
                ctx.fillStyle = color;
                ctx.fillRect(snake[i].x * gridSize, snake[i].y * gridSize, gridSize - 2, gridSize - 2);
            }
            
            // Resetear efectos para el siguiente frame
            ctx.shadowBlur = 0;
        }

        function createFood() {
            food = {
                x: Math.floor(Math.random() * tileCount),
                y: Math.floor(Math.random() * tileCount)
            };
            // Verificar que no aparezca sobre la serpiente
            for(let part of snake) {
                if(part.x === food.x && part.y === food.y) createFood();
            }
        }

        function gameOver() {
            clearInterval(gameInterval);
            isPlaying = false;
            document.getElementById('overlay').style.display = 'flex';
            document.getElementById('overlayTitle').innerText = "üíÄ GAME OVER";
            tg.HapticFeedback.notificationOccurred('error');
        }

        // --- CONTROLES (TOUCH SWIPE + TECLADO) ---
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('keydown', changeDirection);
        
        // Prevenir scroll al jugar en m√≥vil
        canvas.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
            e.preventDefault(); // Importante para evitar scroll
        }, {passive: false});

        canvas.addEventListener('touchmove', function(e){ e.preventDefault(); }, {passive: false});

        canvas.addEventListener('touchend', function(e) {
            let touchEndX = e.changedTouches[0].screenX;
            let touchEndY = e.changedTouches[0].screenY;
            handleSwipe(touchStartX, touchStartY, touchEndX, touchEndY);
        }, {passive: false});

        function handleSwipe(sx, sy, ex, ey) {
            let xDiff = ex - sx;
            let yDiff = ey - sy;

            if (Math.abs(xDiff) > Math.abs(yDiff)) {
                // Horizontal
                if (xDiff > 0 && dx === 0) { dx = 1; dy = 0; }
                else if (xDiff < 0 && dx === 0) { dx = -1; dy = 0; }
            } else {
                // Vertical
                if (yDiff > 0 && dy === 0) { dx = 0; dy = 1; }
                else if (yDiff < 0 && dy === 0) { dx = 0; dy = -1; }
            }
        }

        function changeDirection(event) {
            const LEFT_KEY = 37; const RIGHT_KEY = 39;
            const UP_KEY = 38; const DOWN_KEY = 40;

            const keyPressed = event.keyCode;
            const goingUp = dy === -1;
            const goingDown = dy === 1;
            const goingRight = dx === 1;
            const goingLeft = dx === -1;

            if (keyPressed === LEFT_KEY && !goingRight) { dx = -1; dy = 0; }
            if (keyPressed === UP_KEY && !goingDown) { dx = 0; dy = -1; }
            if (keyPressed === RIGHT_KEY && !goingLeft) { dx = 1; dy = 0; }
            if (keyPressed === DOWN_KEY && !goingUp) { dx = 0; dy = 1; }
        }

        // --- ANUNCIOS & RETIRO ---
        function watchAd(type) {
            if(type === 'adsgram') {
                const AdController = window.Adsgram.init({ blockId: ADSGRAM_ID });
                AdController.show().then(() => { addEnergy(15); }).catch(() => { tg.showAlert("Anuncio no disponible (Adsgram)"); });
            } else {
                if (typeof show_10278425 === 'function') {
                    show_10278425().then(()=>{ addEnergy(10); }).catch(()=>{ tg.showAlert("Anuncio no disponible (Monetag)"); });
                }
            }
        }

        function addEnergy(amount) {
            user.energy += amount;
            if(user.energy > 100) user.energy = 100;
            saveUser();
            tg.showPopup({title: 'Recarga Exitosa', message: `+${amount} Energ√≠a`});
        }

        function retirar() {
            if(user.pts < META) {
                tg.showAlert(`Necesitas ${META} puntos para retirar.`);
                return;
            }
            user.pts -= META;
            saveUser();
            tg.showPopup({
                title: '¬°SOLICITUD ENVIADA!',
                message: 'Toma una captura y env√≠ala al bot de soporte para procesar tu pago.'
            });
        }

        // INICIAR
        loadUser();
    </script>
</body>
        </html>
